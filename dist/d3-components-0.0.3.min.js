/*! D3 Components v0.0.3 | (c) 2017 Zan Pan | MIT license */
d3.components={},d3.defaultOptions={id:"chart",renderer:"svg",standalone:!0,responsive:!0,width:300,aspectRatio:.618034,color:"#1f77b4",colorScheme:d3.schemeCategory10,stroke:"none",strokeWidth:1,fontSize:14,lineHeight:20,title:{show:!1,x:"50%",y:"1.6em",height:"2em",wrapText:!0,wrapWidth:"90%",lineHeight:"2em",stroke:"none",fill:"#333",fontSize:"1.4em",fontWeight:"bold",textAnchor:"middle",text:""},tooltip:{show:!0,autoplay:!1,carousel:{delay:2e3,interval:2e3},html:function(t,e){return"Datum "+e},style:{display:"none",boxSizing:"border-box",position:"absolute",pointerEvents:"none",padding:"0.2em 0.6em",backgroundColor:"#fff",border:"1px solid #999",borderRadius:"0.2em",fontSize:"85%",opacity:.8}},legend:{autoplay:!1,carousel:{delay:2e3,interval:2e3},symbol:{shape:"circle",width:"0.8em",height:"0.8em"},dx:"0.4em",transform:"scale(0.85)",lineHeight:"1.6em",textColor:"#333",disabledTextColor:"#ccc"},axisX:{orient:"bottom",ticks:{number:8,sizeInner:6,sizeOuter:0,padding:4},domain:{strokeWidth:1},fontSize:"0.85em"},axisY:{orient:"left",ticks:{number:6,sizeInner:6,sizeOuter:0,padding:4},domain:{strokeWidth:1},fontSize:"0.85em"},gridX:{show:!1,stroke:"#ccc",strokeDash:[6,4]},gridY:{show:!1,stroke:"#ccc",strokeDash:[6,4]}},d3.parseData=function(t,e){var r=d3.components[t],a=r.schema||{},n=a.hierarchy;if(Array.isArray(e)){if(e=e.filter(function(t){return null!==t&&void 0!==t}).map(function(e,r){return Array.isArray(e)?(e=e.map(function(t){return t.hasOwnProperty("series")||(t.series=String(r)),t}),d3.parseData(t,e)):"object"!==d3.type(e)?{index:String(r),value:e}:e}),"object"===a.type){var i=a.entries;e=e.map(function(e){var r=Object.keys(e);return i.forEach(function(a){var i=a.key,o=a.type,l=null;if(e.hasOwnProperty(i))i===n&&"array"===o&&(e[n]=d3.parseData(t,e[n])),r.splice(r.indexOf(i),1),l=i;else{var s=a.mappings||[];s.some(function(t){var e=r.indexOf(t);return e!==-1&&(r.splice(e,1),l=t,!0)}),null===l&&r.some(function(t){return d3.type(e[t])===o&&(r.splice(r.indexOf(t),1),l=t,!0)})}if(l){var c=e[l];"string"===o?c=String(c):"number"===o?c=Number(c):"date"===o&&(c=new Date(c)),e[i]=c}}),e})}return[].concat.apply([],e)}return d3.parseData(t,[e])[0]},d3.parseOptions=function(t,e){var r=d3.components[t];e=d3.extend(r,e);var a=d3.defaultOptions,n=e.id||a.id,i=d3.select("#"+n);if(a.responsive&&!e.hasOwnProperty("responsive")){if(!e.hasOwnProperty("width")){var o=parseInt(i.style("width"))||a.width;e.width=Math.round(o)}if(!e.hasOwnProperty("height")){var l=e.aspectRatio||a.aspectRatio,s=parseInt(i.style("height"))||e.width*l;e.height=Math.round(s)}e.hasOwnProperty("fontSize")||(e.fontSize=parseInt(i.style("font-size"))),e.hasOwnProperty("lineHeight")||(e.lineHeight=parseInt(i.style("line-height")))}e=d3.extend(a,e);var c=i.node(),d=d3.extend({id:n+"-tooltip"},e.tooltip);if(e.tooltip=d,c.style.position="relative",d.show){var u=d.id,p=d.style,h=d3.select("#"+u).node();if(null===h){h=document.createElement("div"),h.id=u,h.className="tooltip";for(var f in p)p.hasOwnProperty(f)&&(h.style[f]=p[f]);"CANVAS"===c.tagName?c.parentNode.insertBefore(h,c):c.appendChild(h)}}e.chart=c,"CANVAS"===c.tagName&&(e.renderer="canvas",i=c),"canvas"===e.renderer?("CANVAS"!==c.tagName&&(i=document.createElement("canvas"),c.appendChild(i)),i.width=e.width,i.height=e.height,e.context=i.getContext("2d")):e.context=null;for(var f in e)e.hasOwnProperty(f)&&(e[f]=d3.parseValue(e[f],e));if(e.hasOwnProperty("map")){var g=e.map||{},m=g.name||"world";e.map=d3.extend(d3.maps[m],g)}var y=e.fontSize,v=e.lineHeight,x=d3.extend({top:v,right:2*y,bottom:2*v,left:4*y},e.margin);return e.margin=x,e.innerWidth=e.width-x.left-x.right,e.innerHeight=e.height-x.top-x.bottom,e},d3.parseValue=function(t,e){var r=d3.type(t);if("object"===r)for(var a in t)t.hasOwnProperty(a)&&(t[a]=d3.parseValue(t[a],e));else if("string"===r)if(/^\-?\d+\.?\d*(px)$/.test(t))t=Number(t.replace("px",""));else if(/^\-?\d+\.?\d*(em)$/.test(t))e.hasOwnProperty("fontSize")&&(t=Number(t.replace("em",""))*e.fontSize);else if(/^\-?\d+\.?\d*\%$/.test(t))e.hasOwnProperty("width")&&(t=Number(t.replace("%",""))*e.width/100);else if(/^(a|de)scending\(\w+\)$/.test(t)){var n=t.split(/\W/),i=n[0],a=n[1];t=function(t,e){var r="ascdending"===i?-1:1;return t.hasOwnProperty(a)&&e.hasOwnProperty(a)?void 0===t[a]||null===t[a]?r:d3[i](t[a],e[a])||-r:t.data&&e.data?void 0==t.data[a]||null===t.data[a]?r:d3[i](t.data[a],e.data[a])||-r:0}}return t},d3.type=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},d3.extend=function(t,e){var r={};if("object"===d3.type(t))for(var a in t)if(t.hasOwnProperty(a)){var n=t[a];"object"===d3.type(n)&&(n=d3.extend(r[a],n)),r[a]=n}if("object"===d3.type(e))for(var a in e)if(e.hasOwnProperty(a)){var n=e[a];"object"===d3.type(n)&&(n=d3.extend(r[a],n)),r[a]=n}return r},d3.translate=function(t,e){return"translate("+t+","+e+")"},d3.regularPolygon=function(t,e){var r=2*Math.PI/t;return d3.range(t).map(function(t){var a=r*t;return[e*Math.sin(a),-e*Math.cos(a)]})},d3.createPlot=function(t,e){if(!e.standalone)return d3.select(t).select("svg");var r=e.width,a=e.height,n=d3.select(t).append("svg").attr("class",e.type).attr("width",r),i=0,o=e.title;if(o.show){var l=e.margin,s=n.append("text").attr("class","title").attr("x",o.x).attr("y",o.y).attr("stroke",o.stroke).attr("fill",o.fill).attr("font-size",o.fontSize).attr("font-weight",o.fontWeight).attr("text-anchor",o.textAnchor).text(o.text).call(d3.wrapText,o),c=Math.ceil(s.node().getComputedTextLength()/o.wrapWidth);i=c*o.lineHeight,l.top+=i}o.height=i;var d=d3.translate(r/2,a/2+i);n.attr("height",a+i).append("g").attr("class","container").attr("transform",d).attr("stroke",e.stroke).attr("stroke-width",e.strokeWidth);return n},d3.getPosition=function(t,e){for(var r=d3.select(t).node(),a=r.getBoundingClientRect(),n=e.tagName;r.parentElement.tagName!==n;)r=r.parentElement;var i=r.parentElement.getBoundingClientRect();return{top:a.top-i.top,left:a.left-i.left,width:a.width,height:a.height}},d3.setAxis=function(t,e){var r=d3.axisBottom(t),a=e.orient,n=e.ticks;return"top"===a?r=d3.axisTop(t):"left"===a?r=d3.axisLeft(t):"right"===a&&(r=d3.axisRight(t)),r.ticks(n.number).tickSizeInner(n.sizeInner).tickSizeOuter(n.sizeOuter).tickPadding(n.padding).tickValues(n.values).tickFormat(n.format),r},d3.setAxes=function(t,e){var r=t,a=e.width,n=e.height,i=e.axisX,o=e.axisY,l=i.orient,s=o.orient,c=i.domain,d=o.domain,u=d3.setAxis(e.scaleX,i),p=d3.setAxis(e.scaleY,o);if(r.selectAll(".axis").remove(),e.framed)r.append("g").attr("class","axis axis-x").attr("transform",d3.translate(0,n)).call(u),r.append("g").attr("class","axis axis-y").call(p),r.append("g").attr("class","axis axis-x").call(u.tickFormat("")),r.append("g").attr("class","axis axis-y").attr("transform",d3.translate(a,0)).call(p.tickFormat(""));else{var h=r.append("g").attr("class","axis axis-x").call(u),f=r.append("g").attr("class","axis axis-y").call(p);"bottom"===l&&h.attr("transform",d3.translate(0,n)),"right"===s&&f.attr("transform",d3.translate(a,0))}r.selectAll(".axis-x").attr("font-size",i.fontSize).selectAll("text").attr("text-anchor",i.textAnchor).attr("transform",i.transform),r.select(".axis-x").select(".domain").attr("stroke-width",c.strokeWidth),r.selectAll(".axis-y").attr("font-size",o.fontSize).selectAll("text").attr("text-anchor",o.textAnchor).attr("transform",o.transform),r.select(".axis-y").select(".domain").attr("stroke-width",d.strokeWidth);var g=e.gridX,m=e.gridY;r.selectAll(".grid").remove(),g.show&&(r.insert("g",":first-child").attr("class","grid grid-x").attr("stroke-dasharray",g.strokeDash.join()).call(p.tickSize(-a,0).tickFormat("")),r.select(".grid-x").select(".domain").attr("stroke-width",0),r.select(".grid-x").selectAll(".tick").attr("stroke-width",function(){var t=d3.select(this).attr("transform"),e=+t.replace(/\,?\s+/,",").split(/[\,\(\)]/)[2];return 0===e||e===n?0:null}).select("line").attr("stroke",g.stroke)),m.show&&(r.insert("g",":first-child").attr("class","grid grid-y").attr("stroke-dasharray",m.strokeDash.join()).attr("transform",d3.translate(0,n)).call(u.tickSize(-n,0).tickFormat("")),r.select(".grid-y").select(".domain").attr("stroke-width",0),r.select(".grid-y").selectAll(".tick").attr("stroke-width",function(){var t=d3.select(this).attr("transform"),e=+t.replace(/\,?\s+/,",").split(/[\,\(\)]/)[1];return 0===e||e===a?0:null}).select("line").attr("stroke",m.stroke))},d3.setTooltip=function(t,e){if(e.show){var r=d3.select("#"+e.id),a=parseInt(r.style("line-height")),n=e.hoverTarget,i=e.hoverEffect;n.on("mouseover",function(n,o){var l=d3.mouse(t),s=l[0],c=l[1];if(r.attr("class","tooltip").style("display","block").html(e.html(n,o)),isNaN(s)||isNaN(c)){var d=parseInt(r.style("width"))/2,u=parseInt(r.style("height"))+a/6;l=d3.getPosition(this,t),s=l.left+l.width/2-d,c=l.top+l.height/2-u}r.style("left",s+"px").style("top",c+"px"),"darker"===i&&d3.select(this).attr("fill",d3.color(n.color).darker())}).on("mousemove",function(e){var n=d3.mouse(t),i=parseInt(r.style("width"))/2,o=parseInt(r.style("height"))+a/6;r.style("left",n[0]-i+"px").style("top",n[1]-o+"px")}).on("mouseout",function(t){r.style("display","none"),"darker"===i&&d3.select(this).attr("fill",t.color)}),e.autoplay&&n.call(d3.triggerAction,d3.extend({event:"mouseover",carousel:!0},e.carousel))}},d3.setLegend=function(t,e){if(e.show){var r=e.symbol,a=r.shape,n=Math.round(r.width),i=Math.round(r.height),o=e.textColor,l=e.disabledTextColor,s=e.lineHeight,c=t.append("g").attr("class","legend").attr("transform",e.translation).attr("cursor","pointer").selectAll(".legend-item").data(e.bindingData).enter().append("g").attr("class",function(t){return t.hasOwnProperty("disabled")||(t.disabled=t.data&&t.data.disabled||!1),"legend-item"+(t.disabled?" disabled":"")}).attr("transform",e.transform);"circle"===a?c.append("circle").attr("cx",n/2).attr("cy",function(t,e){return s*(e+1)-i/2}).attr("r",Math.min(n,i)/2):"rect"===a&&c.append("rect").attr("width",n).attr("height",i).attr("x",0).attr("y",function(t,e){return s*(e+1)-i}),c.select(a).attr("fill",function(t){return t.disabled?l:t.color}),c.append("text").text(e.text).attr("x",n).attr("y",function(t,e){return s*(e+1)}).attr("dx",e.dx).attr("fill",function(t){return t.disabled?l:o}),c.on("click",function(t){var r=!t.disabled,n=d3.select(this).classed("disabled",r);n.select(a).attr("fill",r?l:t.color),n.select("text").attr("fill",r?l:o),t.disabled=r,e.onclick(t)}),e.autoplay&&c.call(d3.triggerAction,d3.extend({event:"click",carousel:!0},e.carousel))}},d3.wrapText=function(t,e){if(e.wrapText){var r=e.wrapWidth,a=e.lineHeight;t.each(function(){var t=d3.select(this),n=t.text().split(/\s+/).reverse();if(n.length>1){for(var i=t.attr("x"),o=t.attr("y"),l=(parseFloat(t.attr("dy")),t.text(null).append("tspan")),s=n.pop(),c=0,d=[];s;)d.push(s),l.text(d.join(" ")),l.node().getComputedTextLength()>r&&(d.pop(),l.text(d.join(" ")),d=[s],c+=1,l=t.append("tspan").attr("x",i).attr("dy",a).text(s)),s=n.pop();if(e.verticalAlign){var u=e.verticalAlign,p=0;"middle"===u?p=.5:"bottom"===u&&(p=1),t.attr("y",o-c*a*p)}}})}},d3.triggerAction=function(t,e){var r=e.event||e,a=e&&e.filter||null,n=e&&e.sort||null,i=null!==a?t.filter(a):t,o=i.sort(n).nodes();if("object"===d3.type(e)){var l=e.delay||0,s=o.length;if(s&&e.carousel)var c=e.interval||2e3,d=e.limit||s,u=e.randomize,p=e.infinite,h=0,f=0,g=d3.timer(function(t){t>c*f&&(f+=1,d3.select(o[h]).dispatch(r),h=u===!0?Math.floor(Math.random()*s):(h+1)%s),p===!1&&f>=d&&g.stop()},l);else d3.timeout(function(){d3.selectAll(o).dispatch(r)},l)}else d3.selectAll(o).dispatch(r)},d3.imageTiles=function(t,e){var r=e.image,a=r.size,n=d3.tile().size(e.size).scale(e.scale).translate(e.translate)(),i=t.selectAll("image").data(n.filter(function(t){return t[0]<Math.pow(2,t[2])}),function(t){return t});t.attr("transform",function(){var t=n.scale,e=n.translate,r=t/a,i=t%1?Number:Math.round,o=i(e[0]*t),l=i(e[1]*t);return"translate("+o+","+l+") scale("+r+")"}).style("filter",e.filter),i.exit().remove(),i.enter().append("image").attr("xlink:href",r.href).attr("x",function(t){return t[0]*a}).attr("y",function(t){return t[1]*a}).attr("width",a+1).attr("height",a+1)},d3.parseGeoData=function(t,e){var r=t.data,a=t.key||"id",n=e&&e.data||[],i=[],o=[],l=d3.type(r);if("object"===l)if(r.hasOwnProperty("features"))i=r.features;else if(window.topojson&&t.object){var s=r.objects[t.object];i=topojson.feature(r,s).features,e.neighbors&&(o=topojson.neighbors(s.geometries))}return e.mixin?(n.forEach(function(t){var e=t[a],r=i.some(function(r){var n=String(r[a]||r.properties[a]);return e===n&&(t.coordinates=r.geometry.coordinates,!0)});r||i.some(function(r){var n=String(r[a]||r.properties[a]);return!(!/^\W/.test(e)||!new RegExp(e).test(n))&&(t.coordinates=r.geometry.coordinates,!0)})}),n):{features:i.map(function(t,e){var r=String(t[a]||t.properties[a]||e);t.data={id:r,value:void 0};var i=n.some(function(e){return e[a]===r&&(t.data=e,!0)});return i||n.some(function(e){var n=String(e[a]);return!(!/^\W/.test(n)||!new RegExp(n).test(r))&&(t.data=e,!0)}),t}),neighbors:o}},d3.maps={world:{center:[0,0],scale:.25},china:{key:"name",center:[103.3886,35.5636],scale:1}},d3.components.barChart={type:"bar chart",schema:{type:"object",entries:[{key:"category",type:"string",mappings:["label","name"]},{key:"value",type:"number",mappings:["count","frequency","percentage","ratio"]},{key:"series",type:"string",mappings:["group","type"]}]},sort:null,stacked:!1,horizontal:!1,paddingInner:.4,paddingOuter:.4,paddingMidst:0,align:.5,framed:!1,labelX:{show:!1,text:"X",dy:"2.8em"},labelY:{show:!1,text:"Y",dy:"-3em"},legend:{show:null,text:function(t){return t.series}},tooltip:{html:function(t){return t.category+": "+t.value}},margin:{top:"4em",right:"2em",bottom:"2em",left:"4em"}},d3.barChart=function(t,e){t=d3.parseData("barChart",t),e=d3.parseOptions("barChart",e);var r=d3.dispatch("init","update","finalize"),a=e.chart,n=e.renderer,i=(e.context,e.width,e.height,e.innerWidth),o=e.innerHeight,l=e.margin,s=(e.stroke,e.strokeWidth,e.colorScheme),c=(e.fontSize,e.lineHeight,e.categories||[]),d=e.series||[],u=[],p=null,h=null;if(e.horizontal?(p=d3.scaleLinear().rangeRound([0,i]),h=d3.scaleBand().paddingInner(e.paddingInner).paddingOuter(e.paddingOuter).rangeRound([o,0]).align(e.align)):(p=d3.scaleBand().paddingInner(e.paddingInner).paddingOuter(e.paddingOuter).rangeRound([0,i]).align(e.align),h=d3.scaleLinear().rangeRound([o,0])),"svg"===n){var f=d3.createPlot(a,e),g=f.select(".container").attr("transform",d3.translate(l.left,l.top)),m=d3.scaleOrdinal(s),y=function(t){return m(t.series)};r.on("init.data",function(t){var e=d3.set(t,function(t){return t.category}),r=d3.set(t,function(t){return t.series});e.size()!==c.length&&(c=e.values()),r.size()!==d.length&&(d=r.values()),u.length||(u=d.map(function(t){return{series:t,disabled:!1,color:m(t)}})),t.sort(function(t,e){var r=c.indexOf(t.category),a=c.indexOf(e.category);if(r!==a)return d3.ascending(r,a);var n=d.indexOf(t.series),i=d.indexOf(e.series);return d3.ascending(n,i)})}),r.on("init.layout",function(t){var r=e.stacked,a=e.horizontal,n=0;n=r?d3.max(c,function(e){return d3.sum(t.filter(function(t){return t.category===e}),function(t){return t.value})}):d3.max(t,function(t){return t.value}),a?(p.domain([0,n]),h.domain(c)):(p.domain(c),h.domain([0,n])),g.select(".layout").remove();var i=g.append("g").attr("class","layout").selectAll("rect").data(t).enter().append("rect");if(a){var l=h.bandwidth();if(r)i.attr("y",function(t){return h(t.category)}).attr("x",function(e,r){var a=e.category,n=d3.sum(t.slice(0,r),function(t){return t.category===a?t.value:0});return p(n)});else{var s=d.length,u=l/s,f=h.step()*e.paddingMidst,v=u+f+1,x=f*(s-1)/2-1;l=u,i.attr("x",0).attr("y",function(e,r){var a=e.category,n=t.slice(0,r).reduce(function(t,e){return t+(e.category===a?1:0)},0);return h(a)+(e.series!==d[0]?v:1)*n-x})}i.attr("width",function(t){return p(t.value)}).attr("height",l)}else{var l=p.bandwidth();if(r)i.attr("x",function(t){return p(t.category)}).attr("y",function(e,r){var a=e.category,n=d3.sum(t.slice(0,r+1),function(t){return t.category===a?t.value:0});return h(n)});else{var s=d.length,b=l/s,k=p.step()*e.paddingMidst,w=b+k+1,z=k*(s-1)/2-1;l=b,i.attr("x",function(e,r){var a=e.category,n=t.slice(0,r).reduce(function(t,e){return t+(e.category===a?1:0)},0);return p(a)+(e.series!==d[0]?w:1)*n-z}).attr("y",function(t){return h(t.value)})}i.attr("width",l).attr("height",function(t){return o-h(t.value)})}i.attr("stroke",function(t){return t.color=m(t.series),d3.color(t.color).darker()}).attr("fill",y)}),r.on("init.axes",function(t){var r=e.axisX,a=e.axisY;e.horizontal?void 0===r.ticks.format&&(r.ticks.format=d3.format("d")):void 0===a.ticks.format&&(a.ticks.format=d3.format("d")),d3.setAxes(g,{width:i,height:o,scaleX:p,scaleY:h,axisX:r,axisY:a,gridX:e.gridX,gridY:e.gridY,framed:e.framed})}),r.on("update.tooltip",function(t){var r=e.tooltip;r.hoverTarget=t.selectAll("rect"),r.hoverEffect="darker",d3.setTooltip(a,r)}),r.on("finalize.legend",function(){var a=e.legend;null===a.show&&(a.show=u.length>1),a.translation||(a.translation=d3.translate(-l.left,-l.top)),a.bindingData=u,a.onclick=function(e){var a=e.series,n=e.disabled;t.forEach(function(t){t.series===a&&(t.disabled=n)}),r.call("init",this,t.filter(function(t){return!t.disabled})),r.call("update",this,g.select(".layout"))},d3.setLegend(g,a)}),r.call("init",this,t),r.call("update",this,g.select(".layout")),r.call("finalize",this)}},d3.components.pieChart={type:"pie chart",schema:{type:"object",entries:[{key:"label",type:"string",mappings:["category","name"]},{key:"value",type:"number",mappings:["count","percentage","ratio"]}]},sort:null,maxRatio:.8,donutRatio:0,innerRadius:0,labels:{show:!1,dy:"0.25em",stroke:"none",fill:"#fff",centroidRatio:1.2,minAngle:Math.PI/10,wrapText:!1,wrapWidth:"5em",lineHeight:"1.2em",verticalAlign:"middle",text:function(t){var e=(t.endAngle-t.startAngle)/(2*Math.PI);return d3.format(".0%")(e)}},legend:{show:!0,text:function(t){return t.data.label}},tooltip:{html:function(t){var e=(t.endAngle-t.startAngle)/(2*Math.PI);return t.data.label+": "+d3.format(".1%")(e)}}},d3.pieChart=function(t,e){t=d3.parseData("pieChart",t),e=d3.parseOptions("pieChart",e);var r=d3.dispatch("init","update","finalize"),a=e.chart,n=e.renderer,i=e.context,o=e.width,l=e.height,s=e.innerWidth,c=e.innerHeight,d=e.stroke,u=e.strokeWidth,p=e.colorScheme,h=(e.fontSize,e.lineHeight,e.maxRatio),f=e.donutRatio,g=e.outerRadius||Math.min(s,c)/2,m=e.innerRadius||g*f;"number"===d3.type(m)&&"number"===d3.type(g)&&(m=Math.min(m,g*h));var y=d3.pie().sort(e.sort).value(function(t){return t.disabled?0:t.value}),v=d3.arc().innerRadius(m).outerRadius(g).context(i),x=y(t);if("svg"===n){var b=d3.createPlot(a,e),k=b.select(".container");r.on("init.slices",function(t){k.selectAll(".arc").remove(),k.selectAll(".arc").data(t).enter().append("g").attr("class","arc")}),r.on("update.arcs",function(t){var e=d3.scaleOrdinal(p);t.append("path").attr("d",v).attr("fill",function(t){return t.color=e(t.data.label),t.color})}),r.on("update.labels",function(t){var r=e.labels;if(r.show){var a=r.centroidRatio;t.append("text").attr("class","label").attr("x",function(t){return v.centroid(t)[0]*a}).attr("y",function(t){return v.centroid(t)[1]*a}).attr("dy",r.dy).attr("fill",r.fill).attr("text-anchor","middle").text(r.text).attr("opacity",function(t){var e=t.endAngle-t.startAngle;return e>=r.minAngle?1:0}).call(d3.wrapText,r)}}),r.on("update.tooltip",function(t){var r=e.tooltip;r.hoverTarget=t.selectAll("path"),r.hoverEffect="darker",d3.setTooltip(a,r)}),r.on("finalize.legend",function(){var a=e.legend;a.translation||(a.translation=d3.translate(-o/2,-l/2)),a.bindingData=x,a.onclick=function(e){var a=e.data.label,n=e.data.disabled;t.some(function(t){return t.label===a&&(t.disabled=!n,!0)}),r.call("init",this,y(t)),r.call("update",this,k.selectAll(".arc"))},d3.setLegend(k,a)}),r.call("init",this,x),r.call("update",this,k.selectAll(".arc")),r.call("finalize",this)}else"canvas"===n&&(i.translate(o/2,l/2),x.forEach(function(t,e){i.beginPath(),v(t),i.fillStyle=p[e],i.fill(),i.closePath()}),"none"!==d&&(i.beginPath(),x.forEach(v),i.strokeStyle=d,i.lineWidth=u,i.stroke(),i.closePath()))},d3.components.lineChart={type:"line chart",schema:{type:"object",entries:[{key:"label",type:"string",mappings:["category","name"]},{key:"value",type:"number",mappings:["count","percentage","ratio"]}]},sort:null,labels:{show:!1},tooltip:{html:function(t,e){return"Datum "+e}}},d3.lineChart=function(t,e){t=d3.parseData("lineChart",t),e=d3.parseOptions("lineChart",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer;e.context,e.width,e.height,e.stroke,e.strokeWidth,e.colorScheme,e.fontSize,e.lineHeight;if("svg"===a){var n=d3.createPlot(r,e);n.select(".container")}},d3.components.bubbleChart={type:"bubble chart",schema:{type:"object",entries:[{key:"x",type:"number",mappings:["category","name","year"]},{key:"y",type:"number",mappings:["count"]},{key:"z",type:"number",mappings:[]}]},offsetX:[.5,.5],offsetY:[0,0],framed:!1,axisX:{ticks:{format:d3.format("d")}},axisY:{ticks:{format:d3.format("d")}},gridX:{show:!0},labelX:{show:!1,text:"X",dy:"2.8em"},labelY:{show:!1,text:"Y",dy:"-3em"},dots:{scale:"2%",minRadius:4,maxRadius:1/0,stroke:"#fff",opacity:.8,gradient:!1,hue:160,saturation:.8,lightness:.6},tooltip:{html:function(t){return"x = "+t.x+"<br/>y = "+t.y+"<br/>z = "+t.z}}},d3.bubbleChart=function(t,e){t=d3.parseData("bubbleChart",t),e=d3.parseOptions("bubbleChart",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width,e.height,e.innerWidth),i=e.innerHeight,o=e.margin,l=(e.stroke,e.strokeWidth,e.colorScheme),s=(e.fontSize,e.lineHeight,e.offsetX),c=e.offsetY,d=d3.extent(t,function(t){return t.x}),u=d3.extent(t,function(t){return t.y}),p=d3.extent(t,function(t){return t.z}),h=d[0],f=d[1],g=u[0],m=u[1],y=p[0],v=p[1],x=d3.scaleLinear().domain(e.domainX||[h-s[0],f+s[1]]).range(e.rangeX||[0,n]),b=d3.scaleLinear().domain(e.domainY||[g-c[0],m+c[1]]).range(e.rangeY||[i,0]);if("svg"===a){var k=d3.createPlot(r,e),w=k.select(".container").attr("transform",d3.translate(o.left,o.top));d3.setAxes(w,{width:n,height:i,scaleX:x,scaleY:b,axisX:e.axisX,axisY:e.axisY,gridX:e.gridX,gridY:e.gridY,framed:e.framed});var z=e.labelX,A=e.labelY;z.show&&w.append("text").attr("class","label label-x").attr("text-anchor","end").attr("x",n).attr("y",i).attr("dy",z.dy).text(z.text),A.show&&w.append("text").attr("class","label label-y").attr("text-anchor","end").attr("y",0).attr("dy",A.dy).attr("transform","rotate(-90)").text(A.text);var M=d3.scaleOrdinal(l),O=e.dots,S=O.scale,P=O.minRadius,C=O.maxRadius,W=O.opacity,j=O.hue,R=O.saturation,T=O.lightness,I=w.selectAll(".dot").data(t).enter().append("circle").attr("class","dot").attr("cx",function(t){return x(t.x)}).attr("cy",function(t){return b(t.y)}).attr("r",function(t){var e=0;return C!==1/0&&C?C>P&&(e=Math.sqrt((t.z-y)/(v-y))*(C-P)):e=Math.sqrt(t.z/v)*S,e+P}).attr("opacity",W).attr("stroke",O.stroke).attr("fill",function(t){if("function"==typeof O.color)return O.color(t);if(O.gradient){var e=j*(1-t.y/m)+(180-j),r=R*(t.y-g)/(m-g||1)+(1-R),a=T-(1-T)*(t.x-h)/(f-h||1);return d3.hsl(e,r,a)}return M(t.x)}).sort(function(t,e){return e.z-t.z});O.onclick&&I.attr("cursor","pointer").on("click",function(t){"function"==typeof O.onclick&&O.onclick(t)});var D=e.tooltip;D.hoverTarget=I,d3.setTooltip(r,D)}},d3.components.radarChart={type:"radar chart",schema:{type:"object",entries:[{key:"axis",type:"string",mappings:["category","label","name"]},{key:"value",type:"number",mappings:["count","percentage","ratio"]},{key:"series",type:"string",mappings:["group","type"]}]},sort:null,curve:"curveLinearClosed",levels:3,maxValue:0,grids:{show:!0,shape:"polygon",stroke:"#ccc",strokeWidth:1,fill:"none"},rays:{show:!0,stroke:"#999",strokeWidth:1},areas:{stroke:"#1f77b4",strokeWidth:2,fill:"#3182bd",opacity:.65},dots:{show:!0,radius:3,strokeWidth:1,fill:"#fff"},labels:{show:!0,dy:"0.25em",padding:"1em",wrapText:!1,wrapWidth:"10em",lineHeight:"1.2em",verticalAlign:"middle"},legend:{show:null,text:function(t){return t.series}},tooltip:{html:function(t){return t.axis+": "+t.value}}},d3.radarChart=function(t,e){t=d3.parseData("radarChart",t),e=d3.parseOptions("radarChart",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=e.context,i=e.width,o=e.height,l=e.innerWidth,s=e.innerHeight,c=(e.stroke,e.strokeWidth,e.colorScheme),d=(e.fontSize,e.lineHeight,e.axes||[]),u=e.series||[],p=[],h=[];t.forEach(function(t){var e=t.axis,r=t.series;d.indexOf(e)===-1&&d.push(e),u.indexOf(r)===-1&&u.push(r),h.push(t.value)}),p=u.map(function(e){var r=t.filter(function(t){return t.series===e});return{series:e,disabled:!1,data:d.map(function(t){var e=null;return r.some(function(r){return r.axis===t&&(e=r,!0)}),null===e&&(e={axis:t,value:0}),e})}});var f=d.length,g=2*Math.PI/f,m=Math.min(l,s)/2,y=Math.max(d3.max(h),e.maxValue),v=d3.scaleLinear().range([0,m]).domain([0,y]),x=d3.radialLine().radius(function(t){return v(t.value)}).angle(function(t,e){return g*e}).curve(d3[e.curve]).context(n);if("svg"===a){var b=d3.createPlot(r,e),k=b.select(".container"),w=e.grids,z=e.levels;if(w.show){var A=w.shape;"polygon"===A?k.selectAll(".grid").data(d3.range(1,z+1)).enter().append("polygon").attr("class","grid").attr("points",function(t){var e=v(y/z*t);return d3.regularPolygon(f,e).join(" ")}).attr("stroke",w.stroke).attr("stroke-width",w.strokeWidth).attr("fill",w.fill):"circle"===A&&k.selectAll(".grid").data(d3.range(1,z+1)).enter().append("circle").attr("class","grid").attr("cx",0).attr("cy",0).attr("r",function(t){return m/z*t}).attr("stroke",w.stroke).attr("stroke-width",w.strokeWidth).attr("fill",w.fill)}var M=e.rays;M.show&&k.selectAll(".ray").data(d3.range(f)).enter().append("line").attr("class","ray").attr("x1",0).attr("y1",0).attr("x2",function(t){return m*Math.sin(g*t)}).attr("y2",function(t){return-m*Math.cos(g*t)}).attr("stroke",M.stroke).attr("stroke-width",M.strokeWidth);var O=d3.scaleOrdinal(c),S=function(t){return t.color},P=function(t){return d3.color(t.color).darker()},C=e.areas,W=e.dots,j=k.selectAll(".series").data(p).enter().append("g").attr("class","series").attr("stroke",function(t){return t.color=O(t.series),d3.color(t.color).darker()}).attr("stroke-width",C.strokeWidth).style("display",function(t){return t.disabled?"none":"block"});j.append("path").attr("class","area").attr("d",function(t){return x(t.data)}).attr("fill",S).attr("opacity",C.opacity).on("mouseover",function(){j.selectAll(".area").attr("fill","none").attr("pointer-events","none"),d3.select(this).attr("fill",P).attr("pointer-events","visible")}).on("mouseout",function(){j.selectAll(".area").attr("fill",S).attr("pointer-events","visible")});if(W.show)var R=j.selectAll(".dot").data(function(t){return t.data}).enter().append("circle").attr("class","dot").attr("cx",function(t,e){return v(t.value)*Math.sin(g*e)}).attr("cy",function(t,e){return-v(t.value)*Math.cos(g*e)}).attr("r",W.radius).attr("stroke",W.stroke).attr("stroke-width",W.strokeWidth).attr("fill",W.fill);var T=e.labels;if(T.show){var I=m+T.padding;k.selectAll(".label").data(d).enter().append("text").attr("class","label").attr("x",function(t,e){return I*Math.sin(g*e)}).attr("y",function(t,e){return-I*Math.cos(g*e)}).attr("dy",T.dy).attr("text-anchor",function(t,e){var r="middle";return e>0&&e<Math.ceil(f/2)?r="start":e>=Math.floor(f/2)+1&&(r="end"),r}).text(function(t){return t}).call(d3.wrapText,T)}var D=e.legend;null===D.show&&(D.show=p.length>1),D.translation||(D.translation=d3.translate(-i/2,-o/2)),D.bindingData=p,D.onclick=function(){j.style("display",function(t){return t.disabled?"none":"block"})},d3.setLegend(k,D);var X=e.tooltip;X.hoverTarget=R,d3.setTooltip(r,X)}},d3.components.sunburstChart={type:"sunburst chart",schema:{type:"object",hierarchy:"children",entries:[{key:"label",type:"string",mappings:["category","name"]},{key:"value",type:"number",mappings:["count","percentage","ratio"]},{key:"children",type:"array"}]},sort:null,donut:{show:!1,ratio:.2,radius:20},zoomable:!0,labels:{show:!1},tooltip:{html:function(t){return t.data.label+": "+t.data.value}},stroke:"#fff",colorScheme:d3.schemeCategory20c},d3.sunburstChart=function(t,e){t=d3.parseData("sunburstChart",t),e=d3.parseOptions("sunburstChart",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=e.context,i=e.width,o=e.height,l=(e.stroke,e.strokeWidth,e.colorScheme),s=(e.fontSize,e.lineHeight,Math.min(i,o)/2),c=d3.scaleLinear().range([0,2*Math.PI]),d=d3.scaleSqrt().range([0,s]),u=d3.hierarchy(t,function(t){return t.children}).sum(function(t){return t.children?0:t.value});"function"==typeof e.sort&&u.sort(e.sort),d3.partition()(u);var p=d3.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,c(t.x0)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,c(t.x1)))}).innerRadius(function(t){return Math.max(0,d(t.y0))}).outerRadius(function(t){return Math.max(0,d(t.y1))}).context(n);if("svg"===a){var h=d3.createPlot(r,e),f=h.select(".container"),g=d3.scaleOrdinal(l),m=e.donut,y=f.selectAll(".arc").data(u.descendants()).enter().append("g").attr("class","arc").append("path").attr("d",p).attr("opacity",function(t){return m.show&&null===t.parent?0:null}).attr("fill",function(t){return g((t.children?t:t.parent).data.label)});e.zoomable&&y.attr("cursor","pointer").on("click",function(t){var e=s*m.ratio||m.radius;f.transition().tween("scale",function(){var r=d3.interpolate(c.domain(),[t.x0,t.x1]),a=d3.interpolate(d.domain(),[t.y0,1]),n=d3.interpolate(d.range(),[t.y0?e:0,s]);return function(t){c.domain(r(t)),d.domain(a(t)).range(n(t))}}).selectAll("path").attrTween("d",function(t){return function(){return p(t)}})});var v=e.tooltip;v.hoverTarget=y,d3.setTooltip(r,v)}},d3.components.choroplethMap={type:"choropleth map",schema:{type:"object",entries:[{key:"id",type:"string",mappings:["adcode","city","code","county","country","district","name","province","state"]},{key:"value",type:"number",mappings:["count","percentage","ratio"]},{key:"series",type:"string",mappings:["group","type"]}]},levels:5,projection:"geoMercator",coloring:"ordinal",colorScale:"scaleOrdinal",zoomable:!1,scaleExtent:[1,12],graticules:{show:!1,step:[10,10],stroke:"#ccc"},tile:{show:!1,zoomable:!0,scale:512,scaleExtent:[512,262144],image:{size:256}},labels:{show:!1,dy:"0.25em",stroke:"none",fill:"#333",fontSize:"0.5em",opacity:1,text:function(t){return t.data.id}},tooltip:{html:function(t){return t.data.id+": "+t.data.value}},stroke:"#666",fill:"#fff",colorScheme:d3.schemeCategory20c},d3.choroplethMap=function(t,e){t=d3.parseData("choroplethMap",t),e=d3.parseOptions("choroplethMap",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=(e.id,e.renderer),n=(e.context,e.width),i=e.height,o=(e.stroke,e.fill),l=(e.strokeWidth,e.colorScheme),s=(e.fontSize,e.lineHeight,e.domain||[]),c=d3.extent(t,function(t){return t.value}),d=s[0]||c[0]||0,u=s[1]||c[1]||1,p=e.map,h=e.tile,f=d3.geoMercator();h.show&&d3.tile?(e.zoomable=!1,h.size=[n,i],h.center=h.center||p.center,h.scale=Math.max(h.scale,n),f.scale(1/(2*Math.PI)).translate([0,0]).center([0,0])):f=d3[e.projection]().scale(i*p.scale).translate(p.translate||[0,0]).center(p.center);var g=d3.geoPath().projection(f),m=d3.parseGeoData(p,{data:t,neighbors:!0}),y=m.features,v=m.neighbors,x=e.coloring,b=e.colorScale,k=d3.scaleOrdinal(l);if("scaleSequential"===b)k=d3.scaleSequential(l);else if("scaleThreshold"===b){var w=e.thresholds||[];if(!w.length){var z=e.levels,A=(u-d)/z;w=d3.range(z).map(function(t){return A*t+d})}k=d3.scaleThreshold().domain(w).range(l)}if("svg"===a){var M=d3.createPlot(r,e),O=M.select(".container");if(h.show&&d3.tile){var S=f(h.center),P=d3.zoomIdentity.translate(n/2,i/2).scale(h.scale).translate(-S[0],-S[1]),C=d3.zoom().scaleExtent(h.scaleExtent).on("zoom",function(){var t=d3.event.transform;h.scale=t.k,h.translate=[t.x,t.y],d3.imageTiles(M.select(".tile"),h),
f.scale(h.scale/(2*Math.PI)).translate(h.translate),O.selectAll(".region").attr("d",g),O.selectAll(".dot").attr("cx",function(t){return f(t.coordinates)[0]}).attr("cy",function(t){return f(t.coordinates)[1]})});O.attr("transform",d3.translate(0,0)),M.insert("g",":first-child").attr("class","tile"),M.call(C).call(C.transform,P),h.zoomable===!1&&C.on("zoom",null)}var W=e.graticules;if(W.show){var j=d3.geoGraticule().step(W.step);O.append("path").datum(j).attr("class","graticule").attr("d",g).attr("stroke",W.stroke)}var R=O.append("g").attr("class","layer").selectAll(".region").data(y).enter().append("path").attr("class","region").attr("d",g).attr("fill",function(t,e){return t.color?t.color:"none"===o?o:("topological"===x&&v.length?t.value=(0|d3.max(v[e],function(t){return y[t].value}))+1:t.value=t.data.value,void 0===t.value||null===t.value?o:("scaleSequential"===b&&(t.value=(t.value-d)/u),k(t.value)))}),T=e.labels;if(T.show&&O.selectAll(".label").data(y).enter().append("text").attr("class","label").attr("x",function(t){return t.center=g.centroid(t),t.center[0]}).attr("y",function(t){return t.center[1]}).attr("dy",T.dy).attr("text-anchor","middle").attr("stroke",T.stroke).attr("fill",T.fill).attr("font-size",T.fontSize).attr("opacity",T.opacity).text(T.text),e.zoomable){var I=f.scale(),D=f.translate(),C=d3.zoom().scaleExtent(e.scaleExtent).on("zoom",function(t){var e=d3.event.transform;f.scale(e.k*I).translate([D[0]+e.x,D[1]+e.y]),O.selectAll(".graticule").attr("d",g),O.selectAll(".region").attr("d",g),O.selectAll(".dot").attr("cx",function(t){return f(t.coordinates)[0]}).attr("cy",function(t){return f(t.coordinates)[1]}),O.selectAll(".label").attr("x",function(t){return t.center=g.centroid(t),t.center[0]}).attr("y",function(t){return t.center[1]})});M.attr("cursor","move").call(C)}var X=e.tooltip;X.hoverTarget=R,d3.setTooltip(r,X)}},d3.components.bubbleMap={type:"bubble map",schema:{type:"object",entries:[{key:"id",type:"string",mappings:["adcode","city","code","county","country","district","name","province","state"]},{key:"value",type:"number",mappings:["count","percentage","ratio"]},{key:"lng",type:"number",mappings:["lon","longitude"]},{key:"lat",type:"number",mappings:["latitude"]}]},sort:null,projection:"geoMercator",tile:{show:!1,scale:512},dots:{scale:"1%",minRadius:2,maxRadius:1/0,stroke:"#fff",opacity:.8},labels:{show:!1},tooltip:{html:function(t){return t.id+": "+t.value}}},d3.bubbleMap=function(t,e){t=d3.parseData("bubbleMap",t),e=d3.parseOptions("bubbleMap",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width),i=e.height,o=(e.stroke,e.strokeWidth,e.colorScheme),l=(e.fontSize,e.lineHeight,e.domain||[]),s=d3.extent(t,function(t){return t.value}),c=l[0]||s[0]||0,d=l[1]||s[1]||1,u=e.map,p=e.tile,h=d3.geoMercator();if(p.show&&d3.tile?(p.size=[n,i],p.center=p.center||u.center,p.scale=Math.max(p.scale,n),h.scale(1/(2*Math.PI)).translate([0,0]).center([0,0])):h=d3[e.projection]().scale(i*u.scale).translate(u.translate||[0,0]).center(u.center),t=d3.parseGeoData(u,{data:t,mixin:!0}),"svg"===a){var f=d3.createPlot(r,e),g=f.select(".container");if(p.show&&d3.tile){var m=h(p.center),y=d3.zoomIdentity.translate(n/2,i/2).scale(p.scale).translate(-m[0],-m[1]),v=d3.zoom().on("zoom",function(){var t=d3.event.transform;p.scale=t.k,p.translate=[t.x,t.y],h.scale(p.scale/(2*Math.PI)).translate(p.translate),g.selectAll(".dot").attr("cx",function(t){return h(t.coordinates)[0]}).attr("cy",function(t){return h(t.coordinates)[1]})});g.call(v).call(v.transform,y),v.on("zoom",null)}var x=d3.scaleOrdinal(o),b=e.dots,k=b.scale,w=b.minRadius,z=b.maxRadius,A=g.append("g").attr("class","layer").attr("stroke",b.stroke).attr("opacity",b.opacity).selectAll(".dot").data(t).enter().append("circle").attr("class","dot").each(function(t){t.coordinates=t.coordinates||[t.lng,t.lat]}).attr("cx",function(t){return h(t.coordinates)[0]}).attr("cy",function(t){return h(t.coordinates)[1]}).attr("r",function(t){var e=0;return z!==1/0&&z?z>w&&(e=Math.sqrt((t.value-c)/(d-c))*(z-w)):e=Math.sqrt(t.value/d)*k,e+w}).attr("fill",function(t){return x(t.value)}).sort(function(t,e){return e.value-t.value}),M=e.tooltip;M.hoverTarget=A,d3.setTooltip(r,M)}};