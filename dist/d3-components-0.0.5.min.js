/*! D3 Components v0.0.5 | (c) 2017 Zan Pan | MIT license */
d3.components={},d3.defaultOptions={id:"chart",renderer:"svg",standalone:!0,responsive:!0,width:400,height:250,aspectRatio:.618034,color:"#1f77b4",colorScheme:d3.schemeCategory10,stroke:"none",strokeWidth:1,fontSize:14,lineHeight:20,title:{show:!1,x:"50%",y:"1.6em",height:"2em",wrapText:!0,wrapWidth:"90%",lineHeight:"2em",stroke:"none",fill:"currentColor",fontSize:"1.4em",fontWeight:"bold",textAnchor:"middle",text:""},tooltip:{show:!0,autoplay:!1,carousel:{delay:2e3,interval:2e3},html:function(t,e){return"Datum "+e},style:{display:"none",boxSizing:"border-box",position:"absolute",pointerEvents:"none",padding:"0.2em 0.6em",backgroundColor:"#fff",border:"1px solid #999",borderRadius:"0.2em",color:"#333",fontSize:"85%",opacity:.8}},legend:{autoplay:!1,carousel:{delay:2e3,interval:2e3},type:"checkbox",display:"block",maxWidth:"6.8em",columns:5,symbol:{shape:"rect",width:"0.8em",height:"0.8em"},dx:"0.4em",transform:"scale(0.85)",lineHeight:"1.6em",textColor:"currentColor",disabledTextColor:"#ccc",key:function(t,e){return e}},axisX:{show:!0,orient:"bottom",ticks:{number:8,sizeInner:6,sizeOuter:0,padding:4},domain:{show:!0,stroke:"currentColor",strokeWidth:1},fontSize:"0.85em",stroke:"currentColor",fill:"currentColor"},axisY:{show:!0,orient:"left",ticks:{number:6,sizeInner:6,sizeOuter:0,padding:4},domain:{show:!0,stroke:"currentColor",strokeWidth:1},fontSize:"0.85em",stroke:"currentColor",fill:"currentColor"},gridX:{show:!1,stroke:"#ccc",strokeDash:[6,4]},gridY:{show:!1,stroke:"#ccc",strokeDash:[6,4]},labelX:{show:!1,text:"X",dy:"2.8em",fill:"currentColor",textAnchor:"end"},labelY:{show:!1,text:"Y",dy:"-3em",fill:"currentColor",textAnchor:"end",transform:"rotate(-90)"}},d3.createChart=function(t){if("object"===d3.type(t)){var e=d3[t.type];if("function"===d3.type(e))if(t.reload===!0){var r=Number(t.interval);t.reload=!1,d3.interval(function(){d3.createChart(t)},r)}else{var a=t.data,n=t.options,i=d3.type(a);if("string"===i)d3.json(a,function(t){return e(t,n)});else{if("object"!==i||!a.api)return e(a,n);var o=a.type,l=a.api;if("json"===o)d3.json(l,function(t){return e(t,n)});else if("csv"===o){var s=a.row||function(t){return t};d3.csv(l,s,function(t){return e(t,n)})}}}}},d3.parseData=function(t,e){var r=d3.components[t],a=r.schema||{},n=a.hierarchy,i=d3.type(e);if("array"===i){if(e=e.filter(function(t){return null!==t&&void 0!==t}).map(function(e,r){return Array.isArray(e)?(e=e.map(function(t){return t.hasOwnProperty("series")||(t.series=String(r)),t}),d3.parseData(t,e)):"object"!==d3.type(e)?{index:String(r),value:e}:e}),"object"===a.type){var o=a.entries;e=e.map(function(e){var r=Object.keys(e);return o.forEach(function(a){var i=a.key,o=a.type,l=null;if(e.hasOwnProperty(i))i===n&&"array"===o&&(e[n]=d3.parseData(t,e[n])),r.splice(r.indexOf(i),1),l=i;else{var s=a.mappings||[];s.some(function(t){var e=r.indexOf(t);return e!==-1&&(r.splice(e,1),l=t,!0)}),null===l&&r.some(function(t){return d3.type(e[t])===o&&(r.splice(r.indexOf(t),1),l=t,!0)})}if(l){var d=e[l];"string"===o?d=String(d):"number"===o?d=Number(d):"date"===o&&(d=new Date(d)),e[i]=d}}),e})}return[].concat.apply([],e)}return"object"===i?d3.parseData(t,[e])[0]:e},d3.parseOptions=function(t,e){var r=d3.components[t];e=d3.extend(r,e);var a=d3.defaultOptions,n=e.id||a.id,i=d3.select("#"+n);if(a.responsive&&!e.hasOwnProperty("responsive")){if(!e.hasOwnProperty("width")){var o=parseInt(i.style("width"))||a.width;e.width=Math.round(o)}if(!e.hasOwnProperty("height")){var l=e.aspectRatio||a.aspectRatio,s=parseInt(i.style("height"))||e.width*l;e.height=Math.round(s)}e.hasOwnProperty("fontSize")||(e.fontSize=parseInt(i.style("font-size"))),e.hasOwnProperty("lineHeight")||(e.lineHeight=parseInt(i.style("line-height")))}e=d3.extend(a,e);var d=i.node(),c=d3.extend({id:n+"-tooltip"},e.tooltip);if(e.tooltip=c,d.style.position="relative",c.show){var u=c.id,p=c.style,h=d3.select("#"+u).node();if(null===h){h=document.createElement("div"),h.id=u,h.className="tooltip";for(var f in p)p.hasOwnProperty(f)&&(h.style[f]=p[f]);"CANVAS"===d.tagName?d.parentNode.insertBefore(h,d):d.appendChild(h)}}e.chart=d,"CANVAS"===d.tagName&&(e.renderer="canvas",i=d),"canvas"===e.renderer?("CANVAS"!==d.tagName&&(i=document.createElement("canvas"),d.appendChild(i)),i.width=e.width,i.height=e.height,e.context=i.getContext("2d")):e.context=null;for(var f in e)e.hasOwnProperty(f)&&(e[f]=d3.parseValue(e[f],e));if(e.hasOwnProperty("map")){var m=e.map||{},g=m.name||"world";e.map=d3.extend(d3.mapData[g],m)}var y=e.fontSize,v=e.lineHeight,x=d3.extend({top:v,right:2*y,bottom:2*v,left:4*y},e.margin);return e.margin=x,e.innerWidth=e.width-x.left-x.right,e.innerHeight=e.height-x.top-x.bottom,e},d3.parseValue=function(t,e){var r=d3.type(t);if("object"===r)for(var a in t)t.hasOwnProperty(a)&&(t[a]=d3.parseValue(t[a],e));else if("string"===r)if(/^\-?\d+\.?\d*(px)$/.test(t))t=Number(t.replace("px",""));else if(/^\-?\d+\.?\d*(em)$/.test(t))e.hasOwnProperty("fontSize")&&(t=Number(t.replace("em",""))*e.fontSize);else if(/^\-?\d+\.?\d*\%$/.test(t))e.hasOwnProperty("width")&&(t=Number(t.replace("%",""))*e.width/100);else if(/^(a|de)scending\(\w+\)$/.test(t)){var n=t.split(/\W/),i=n[0],a=n[1];t=function(t,e){var r="ascdending"===i?-1:1;return t.hasOwnProperty(a)&&e.hasOwnProperty(a)?void 0===t[a]||null===t[a]?r:d3[i](t[a],e[a])||-r:t.data&&e.data?void 0==t.data[a]||null===t.data[a]?r:d3[i](t.data[a],e.data[a])||-r:0}}return t},d3.type=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},d3.extend=function(t,e){var r={};if("object"===d3.type(t))for(var a in t)if(t.hasOwnProperty(a)){var n=t[a];"object"===d3.type(n)&&(n=d3.extend(r[a],n)),r[a]=n}if("object"===d3.type(e))for(var a in e)if(e.hasOwnProperty(a)){var n=e[a];"object"===d3.type(n)&&(n=d3.extend(r[a],n)),r[a]=n}return r},d3.translate=function(t,e){return"translate("+t+","+e+")"},d3.regularPolygon=function(t,e){var r=2*Math.PI/t;return d3.range(t).map(function(t){var a=r*t;return[e*Math.sin(a),-e*Math.cos(a)]})},d3.createPlot=function(t,e){if(!e.standalone){var r=d3.select(t).select("svg");if(null!==r.node())return r}var a=e.width,n=e.height,r=d3.select(t).append("svg").attr("class",e.type).attr("width",a).attr("display","block"),i=0,o=e.title;if(o.show){var l=e.margin,s=r.append("text").attr("class","title").attr("x",o.x).attr("y",o.y).attr("stroke",o.stroke).attr("fill",o.fill).attr("font-size",o.fontSize).attr("font-weight",o.fontWeight).attr("text-anchor",o.textAnchor).text(o.text).call(d3.wrapText,o),d=Math.ceil(s.node().getComputedTextLength()/o.wrapWidth);i=d*o.lineHeight,l.top+=i}o.height=i;var c=d3.translate(a/2,n/2+i);r.attr("height",n+i).append("g").attr("class","container").attr("transform",c).attr("stroke",e.stroke).attr("stroke-width",e.strokeWidth);return r},d3.getPosition=function(t,e){for(var r=d3.select(t).node(),a=r.getBoundingClientRect(),n=e.tagName;r.parentElement.tagName!==n;)r=r.parentElement;var i=r.parentElement.getBoundingClientRect();return{top:a.top-i.top,left:a.left-i.left,width:a.width,height:a.height}},d3.setAxis=function(t,e){var r=d3.axisBottom(t),a=e.orient,n=e.ticks||{};return"top"===a?r=d3.axisTop(t):"left"===a?r=d3.axisLeft(t):"right"===a&&(r=d3.axisRight(t)),r.ticks(n.number).tickSizeInner(n.sizeInner).tickSizeOuter(n.sizeOuter).tickPadding(n.padding).tickValues(n.values).tickFormat(n.format),r},d3.setAxes=function(t,e){var r=t,a=e.width,n=e.height,i=e.axisX||{},o=e.axisY||{},l=i.orient||"bottom",s=o.orient||"left",d=i.domain,c=o.domain,u=d3.setAxis(e.scaleX,i),p=d3.setAxis(e.scaleY,o);if(e.framed){if(i.show){var h=r.select(".axis-bottom"),f=r.select(".axis-top");h.empty()&&(h=r.append("g").attr("class","axis axis-x axis-bottom")),f.empty()&&(f=r.append("g").attr("class","axis axis-x axis-top")),h.attr("transform",d3.translate(0,n)).call(u),f.call(u.tickFormat(""))}if(o.show){var m=r.select(".axis-left"),g=r.select(".axis-right");m.empty()&&(m=r.append("g").attr("class","axis axis-y axis-left")),g.empty()&&(g=r.append("g").attr("class","axis axis-y axis-right")),m.call(p),g.attr("transform",d3.translate(a,0)).call(p.tickFormat(""))}}else{if(i.show){var y=r.select(".axis-x");y.empty()&&(y=r.append("g").attr("class","axis axis-x")),"bottom"===l&&y.attr("transform",d3.translate(0,n)),y.call(u)}if(o.show){var v=r.select(".axis-y");v.empty()&&(v=r.append("g").attr("class","axis axis-y")),"right"===s&&v.attr("transform",d3.translate(a,0)),v.call(p)}}i.show&&(r.selectAll(".axis-x").attr("font-size",i.fontSize).selectAll("text").attr("text-anchor",i.textAnchor).attr("transform",i.transform).attr("rotate",i.rotate).attr("fill",i.fill),r.selectAll(".axis-x").selectAll("line").attr("stroke",i.stroke).attr("stroke-width",i.strokeWidth),r.selectAll(".axis-x").select(".domain").attr("stroke",d.stroke).attr("stroke-width",d.strokeWidth).attr("display",d.show?"block":"none")),o.show&&(r.selectAll(".axis-y").attr("font-size",o.fontSize).selectAll("text").attr("text-anchor",o.textAnchor).attr("transform",o.transform).attr("rotate",o.rotate).attr("fill",o.fill),r.selectAll(".axis-y").selectAll("line").attr("stroke",o.stroke).attr("stroke-width",o.strokeWidth),r.selectAll(".axis-y").select(".domain").attr("stroke",d.stroke).attr("stroke-width",c.strokeWidth).attr("display",c.show?"block":"none"));var x=e.gridX||{},k=e.gridY||{};if(x.show){var b=r.select(".grid-x");b.empty()&&(b=r.insert("g",":first-child").attr("class","grid grid-x")),b.attr("stroke-dasharray",x.strokeDash.join()).call(p.tickSize(-a,0).tickFormat("")),b.select(".domain").attr("stroke-width",0),b.selectAll(".tick").attr("stroke-width",function(){var t=d3.select(this).attr("transform"),e=+t.replace(/\,?\s+/,",").split(/[\,\(\)]/)[2];return Math.abs(e)<1||Math.abs(e-n)<1?0:null}).select("line").attr("stroke",x.stroke)}if(k.show){var w=r.select(".grid-y");w.empty()&&(w=r.insert("g",":first-child").attr("class","grid grid-y")),w.attr("stroke-dasharray",k.strokeDash.join()).attr("transform",d3.translate(0,n)).call(u.tickSize(-n,0).tickFormat("")),w.select(".domain").attr("stroke-width",0),w.selectAll(".tick").attr("stroke-width",function(){var t=d3.select(this).attr("transform"),e=+t.replace(/\,?\s+/,",").split(/[\,\(\)]/)[1];return Math.abs(e)<1||Math.abs(e-a)<1?0:null}).select("line").attr("stroke",k.stroke)}},d3.setLabels=function(t,e){var r=t,a=e.width,n=e.height,i=e.labelX,o=e.labelY,l=i.textAnchor,s=o.textAnchor;if(i.show){var d=r.select(".label-x"),c=0;"middle"===l?c=a/2:"end"===l&&(c=a),d.empty()&&(d=r.append("text").attr("class","label label-x")),d.attr("x",c).attr("y",n).attr("dy",i.dy).attr("transform",i.transform).attr("fill",i.fill).attr("text-anchor",l).text(i.text)}if(o.show){var u=r.select(".label-y"),p=n;"middle"===s?p=n/2:"end"===s&&(p=0),u.empty()&&(u=r.append("text").attr("class","label label-y")),u.attr("x",-p).attr("y",0).attr("dy",o.dy).attr("transform",o.transform).attr("fill",o.fill).attr("text-anchor",s).text(o.text)}},d3.setTooltip=function(t,e){if(e.show){var r=d3.select("#"+e.id),a=parseInt(r.style("line-height")),n=e.target,i=e.effect;n.on("mouseover",function(n,o){var l=d3.mouse(t),s=l[0],d=l[1];if(r.attr("class","tooltip").style("display","block").html(e.html(n,o)),isNaN(s)||isNaN(d)){var c=parseInt(r.style("width"))/2,u=parseInt(r.style("height"))+a/6;l=d3.getPosition(this,t),s=l.left+l.width/2-c,d=l.top+l.height/2-u}r.style("left",s+"px").style("top",d+"px"),"darker"===i&&d3.select(this).attr("fill",d3.color(n.color).darker())}).on("mousemove",function(e){var n=d3.mouse(t),i=parseInt(r.style("width"))/2,o=parseInt(r.style("height"))+a/6;r.style("left",n[0]-i+"px").style("top",n[1]-o+"px")}).on("mouseout",function(t){r.style("display","none"),"darker"===i&&d3.select(this).attr("fill",t.color)}),e.autoplay&&n.call(d3.triggerAction,d3.extend({event:"mouseover",carousel:!0},e.carousel))}},d3.setLegend=function(t,e){var r=e.show,a=e.data;if(r||null===r&&a.length>1){var n=e.type,i=e.display,o=e.maxWidth,l=e.columns,s=e.symbol,d=s.shape,c=Math.round(s.width),u=Math.round(s.height),p=e.textColor,h=e.disabledTextColor,f=e.lineHeight,m=t.select(".legend");m.empty()&&(m=t.append("g").attr("class","legend").attr("transform",e.translation).attr("cursor","pointer"));var g=m.selectAll(".legend-item").data(a,e.key);g.exit().remove(),g.enter().append("g").attr("class",function(t){return t.hasOwnProperty("disabled")||(t.disabled=t.data&&t.data.disabled||!1),"legend-item"+(t.disabled?" disabled":"")}).attr("transform",e.transform);var y=t.selectAll(".legend-item"),v=y.select(d);v.empty()&&("circle"===d?y.append("circle").attr("cx",function(t,e){return"inline-block"===i?o*(e%l)+c/2:c/2}).attr("cy",function(t,e){return"inline-block"===i&&(e=Math.floor(e/l)),f*(e+1)-u/2}).attr("r",Math.min(c,u)/2):"rect"===d&&y.append("rect").attr("width",c).attr("height",u).attr("x",function(t,e){return"inline-block"===i?o*(e%l):0}).attr("y",function(t,e){return"inline-block"===i&&(e=Math.floor(e/l)),f*(e+1)-u})),y.select(d).attr("fill",function(t){return t.disabled?h:t.color});var x=e.dx,k=o-c-2*x,b=y.select("text");b.empty()&&y.append("text").attr("x",function(t,e){return"inline-block"===i?o*(e%l)+c:c}).attr("y",function(t,e){return"inline-block"===i&&(e=Math.floor(e/l)),f*(e+1)}).attr("dx",x).attr("lengthAdjust","spacingAndGlyphs"),y.select("text").text(e.text).attr("fill",function(t){return t.disabled?h:p}).attr("textLength",function(t){var e=d3.select(this).node().getComputedTextLength();return e>k?k:null}),y.on("click",function(t){var r=t.disabled;"checkbox"===n?t.disabled=!r:"radio"===n&&(t.disabled=!1);var a=d3.select(this).classed("disabled",t.disabled);a.select(d).attr("fill",t.disabled?h:t.color),a.select("text").attr("fill",t.disabled?h:p),e.onclick(t)}),e.autoplay&&y.call(d3.triggerAction,d3.extend({event:"click",carousel:!0},e.carousel))}},d3.wrapText=function(t,e){if(e.wrapText){var r=e.wrapWidth,a=e.lineHeight;t.each(function(){var t=d3.select(this),n=t.text().split(/\s+/).reverse();if(n.length>1){for(var i=t.attr("x"),o=t.attr("y"),l=(parseFloat(t.attr("dy")),t.text(null).append("tspan")),s=n.pop(),d=0,c=[];s;)c.push(s),l.text(c.join(" ")),l.node().getComputedTextLength()>r&&(c.pop(),l.text(c.join(" ")),c=[s],d+=1,l=t.append("tspan").attr("x",i).attr("dy",a).text(s)),s=n.pop();if(e.verticalAlign){var u=e.verticalAlign,p=0;"middle"===u?p=.5:"bottom"===u&&(p=1),t.attr("y",o-d*a*p)}}})}},d3.triggerAction=function(t,e){var r=e.event||e,a=e&&e.filter||null,n=e&&e.sort||null,i=null!==a?t.filter(a):t,o=i.sort(n).nodes();if("object"===d3.type(e)){var l=e.delay||0,s=o.length;if(s&&e.carousel)var d=e.interval||2e3,c=e.limit||s,u=e.randomize,p=e.infinite,h=0,f=0,m=d3.timer(function(t){t>d*f&&(f+=1,d3.select(o[h]).dispatch(r),h=u===!0?Math.floor(Math.random()*s):(h+1)%s),p===!1&&f>=c&&m.stop()},l);else d3.timeout(function(){d3.selectAll(o).dispatch(r)},l)}else d3.selectAll(o).dispatch(r)},d3.imageTiles=function(t,e){var r=e.image,a=r.size,n=d3.tile().size(e.size).scale(e.scale).translate(e.translate).wrap(e.wrap)(),i=t.selectAll("image").data(n,function(t){return[t.tx,t.ty,t.z]});i.exit().remove(),i.enter().append("image").attr("xlink:href",r.href).attr("x",function(t){return t.tx}).attr("y",function(t){return t.ty}).attr("width",a+1).attr("height",a+1),t.attr("transform",function(){var t=n.scale,e=n.translate,r=t/a,i=t%1?Number:Math.round,o=i(e[0]*t),l=i(e[1]*t);return"translate("+o+","+l+") scale("+r+")"}).style("filter",e.filter)},d3.parseGeoData=function(t,e){var r=t.data,a=t.key||"id",n=e&&e.data||[],i=[],o=[],l=d3.type(r);if("object"===l)if(r.hasOwnProperty("features"))i=r.features;else if(window.topojson&&t.object){var s=r.objects[t.object];i=topojson.feature(r,s).features,e.neighbors&&(o=topojson.neighbors(s.geometries))}return e.mixin?(n.forEach(function(t){var e=t[a],r=i.some(function(r){var n=String(r[a]||r.properties[a]);return e===n&&(t.coordinates=r.geometry.coordinates,!0)});r||i.some(function(r){var n=String(r[a]||r.properties[a]);return!(!/^\W/.test(e)||!new RegExp(e).test(n))&&(t.coordinates=r.geometry.coordinates,!0)})}),n):{features:i.map(function(t,e){var r=String(t[a]||t.properties[a]||e);t.data={id:r,value:void 0};var i=n.some(function(e){return(e[a]||e.id)===r&&(t.data=e,!0)});return i||n.some(function(e){var n=String(e[a]);return!(!/^\W/.test(n)||!new RegExp(n).test(r))&&(t.data=e,!0)}),t}),neighbors:o}},d3.mapData={world:{center:[0,0],scale:1},china:{key:"name",center:[103.3886,35.5636],scale:1}},d3.components.barChart={type:"bar chart",schema:{type:"object",entries:[{key:"category",type:"string",mappings:["label","name"]},{key:"value",type:"number",mappings:["count","frequency","percentage","ratio"]},{key:"series",type:"string",optional:!0,mappings:["group","type"]}]},sort:null,stacked:!1,horizontal:!1,paddingInner:.4,paddingOuter:.4,paddingMidst:0,align:.5,framed:!1,refline:{show:!1,stroke:"#d62728",strokeWidth:1,strokeDash:[6,4],threshold:1/0},legend:{show:null,text:function(t){return t.series}},tooltip:{html:function(t){return t.category+": "+t.value}},margin:{top:"4em",right:"2em",bottom:"2em",left:"4em"}},d3.barChart=function(t,e){t=d3.parseData("barChart",t),e=d3.parseOptions("barChart",e);var r=d3.dispatch("init","update","finalize"),a=e.chart,n=e.renderer,i=(e.context,e.width,e.height,e.innerWidth),o=e.innerHeight,l=e.margin,s=(e.stroke,e.strokeWidth),d=e.colorScheme,c=(e.fontSize,e.lineHeight,e.categories||[]),u=e.series||[],p=[],h=null,f=null,m=0;e.horizontal?(h=d3.scaleLinear().rangeRound([0,i]),f=d3.scaleBand().paddingInner(e.paddingInner).paddingOuter(e.paddingOuter).rangeRound([o,0]).align(e.align)):(h=d3.scaleBand().paddingInner(e.paddingInner).paddingOuter(e.paddingOuter).rangeRound([0,i]).align(e.align),f=d3.scaleLinear().rangeRound([o,0]));var g=d3.scaleOrdinal().domain(u).range(d),y=function(t){return g(t.series)};if("svg"===n){var v=d3.createPlot(a,e),x=v.select(".container").attr("transform",d3.translate(l.left,l.top));r.on("init.data",function(t){var e=d3.set(t,function(t){return t.category}),r=d3.set(t,function(t){return t.series});e.size()!==c.length&&(c=e.values()),r.size()!==u.length&&(u=r.values()),p.length||(p=u.map(function(t){return{series:t,disabled:!1,color:g(t)}})),t.sort(function(t,e){var r=c.indexOf(t.category),a=c.indexOf(e.category);if(r!==a)return d3.ascending(r,a);var n=u.indexOf(t.series),i=u.indexOf(e.series);return d3.ascending(n,i)})}),r.on("init.layout",function(t){var r=e.stacked,a=e.horizontal;m=r?d3.max(c,function(e){return d3.sum(t,function(t){return t.category===e?t.value:0})}):d3.max(t,function(t){return t.value}),a?(h.domain([0,m]),f.domain(c)):(h.domain(c),f.domain([0,m]));var n=x.select(".layout");n.empty()&&(n=x.append("g").attr("class","layout"));var i=n.selectAll(".slice").data(t);i.exit().remove(),i.enter().append("rect").attr("class","slice");var l=n.selectAll(".slice");if(a){var d=f.bandwidth();if(r)l.attr("y",function(t){return f(t.category)}).attr("x",function(e,r){var a=e.category,n=d3.sum(t.slice(0,r),function(t){return t.category===a?t.value:0});return h(n)});else{var p=u.length,v=d/p,k=f.step()*e.paddingMidst,b=v+k+1,w=k*(p-1)/2-1;d=v,l.attr("x",0).attr("y",function(e,r){var a=e.category,n=t.slice(0,r).reduce(function(t,e){return t+(e.category===a?1:0)},0);return f(a)+(e.series!==u[0]?b:1)*n-w})}l.attr("width",function(t){return h(t.value)}).attr("height",d)}else{var d=h.bandwidth();if(r)l.attr("x",function(t){return h(t.category)}).attr("y",function(e,r){var a=e.category,n=d3.sum(t.slice(0,r+1),function(t){return t.category===a?t.value:0});return f(n)});else{var p=u.length,z=d/p,A=h.step()*e.paddingMidst,S=z+A+1,M=A*(p-1)/2-1;d=z,l.attr("x",function(e,r){var a=e.category,n=t.slice(0,r).reduce(function(t,e){return t+(e.category===a?1:0)},0);return h(a)+(e.series!==u[0]?S:1)*n-M}).attr("y",function(t){return f(t.value)})}l.attr("width",d).attr("height",function(t){return o-f(t.value)})}l.attr("stroke",function(t){return t.color=g(t.series),d3.color(t.color).darker()}).attr("stroke-width",s).attr("fill",y)}),r.on("init.refline",function(t){var r=e.refline,a=r.threshold;if(r.show&&m>a){var n=x.select(".refline");if(n.empty()&&(n=x.select(".layout").append("line").attr("class","refline")),n.attr("stroke",r.stroke).attr("stroke-width",r.strokeWidth).attr("stroke-dasharray",r.strokeDash.join()),e.horizontal){var l=h(a);n.attr("x1",l).attr("y1",0).attr("x2",l).attr("y2",o)}else{var s=f(a);n.attr("x1",0).attr("y1",s).attr("x2",i).attr("y2",s)}}}),r.on("init.axes",function(t){var r=e.axisX,a=e.axisY;e.horizontal?void 0===r.ticks.format&&(r.ticks.format=d3.format("d")):void 0===a.ticks.format&&(a.ticks.format=d3.format("d")),d3.setAxes(x,{width:i,height:o,scaleX:h,scaleY:f,axisX:r,axisY:a,gridX:e.gridX,gridY:e.gridY,framed:e.framed})}),r.on("init.labels",function(t){d3.setLabels(x,{width:i,height:o,labelX:e.labelX,labelY:e.labelY})}),r.on("update.tooltip",function(t){var r=e.tooltip;r.target=t.selectAll("rect"),r.effect="darker",d3.setTooltip(a,r)}),r.on("finalize.legend",function(){var a=e.legend;a.translation||(a.translation=d3.translate(-l.left,-l.top)),a.data=p,a.onclick=function(e){var a=e.series,n=e.disabled;t.forEach(function(t){t.series===a&&(t.disabled=n)}),r.call("init",this,t.filter(function(t){return!t.disabled})),r.call("update",this,x.select(".layout"))},d3.setLegend(x,a)}),r.call("init",this,t),r.call("update",this,x.select(".layout")),r.call("finalize",this)}},d3.components.pieChart={type:"pie chart",schema:{type:"object",entries:[{key:"label",type:"string",mappings:["category","name"]},{key:"value",type:"number",mappings:["count","percentage","ratio"]}]},sort:null,arcs:{maxRatio:.8,donutRatio:0,innerRadius:0},labels:{show:!1,dy:"0.25em",stroke:"none",fill:"#fff",centroidRatio:1,minAngle:Math.PI/10,wrapText:!1,wrapWidth:"5em",lineHeight:"1.2em",verticalAlign:"middle",text:function(t){var e=(t.endAngle-t.startAngle)/(2*Math.PI);return d3.format(".0%")(e)}},legend:{show:!0,text:function(t){return t.data.label}},tooltip:{html:function(t){var e=(t.endAngle-t.startAngle)/(2*Math.PI);return t.data.label+": "+d3.format(".1%")(e)}}},d3.pieChart=function(t,e){t=d3.parseData("pieChart",t),e=d3.parseOptions("pieChart",e);var r=d3.dispatch("init","update","finalize"),a=e.chart,n=e.renderer,i=e.context,o=e.width,l=e.height,s=e.innerWidth,d=e.innerHeight,c=(e.stroke,e.strokeWidth,e.colorScheme),u=(e.fontSize,e.lineHeight,e.arcs),p=u.maxRatio,h=u.donutRatio,f=u.outerRadius||Math.min(s,d)/2,m=u.innerRadius||f*h;"number"===d3.type(m)&&"number"===d3.type(f)&&(m=Math.min(m,f*p));var g=d3.pie().sort(e.sort).value(function(t){return t.disabled?0:t.value}),y=d3.arc().innerRadius(m).outerRadius(f).context(i),v=g(t);if("svg"===n){var x=d3.createPlot(a,e),k=x.select(".container");r.on("init.slices",function(t){var e=k.selectAll(".arc").data(t,function(t){return t.label});e.exit().remove(),e.enter().append("g").attr("class","arc").attr("stroke",u.stroke)}),r.on("update.arcs",function(t){var e=d3.scaleOrdinal(c);t.append("path").attr("d",y).attr("fill",function(t){return t.color=e(t.data.label),t.color})}),r.on("update.labels",function(t){var r=e.labels;if(r.show){var a=r.centroidRatio;t.append("text").attr("class","label").attr("x",function(t){return y.centroid(t)[0]*a}).attr("y",function(t){return y.centroid(t)[1]*a}).attr("dy",r.dy).attr("fill",r.fill).attr("stroke",r.stroke).attr("text-anchor","middle").text(r.text).style("display",function(t){var e=t.endAngle-t.startAngle;return e<r.minAngle?"none":"block"}).call(d3.wrapText,r)}}),r.on("update.tooltip",function(t){var r=e.tooltip;r.target=t.selectAll("path"),r.effect="darker",d3.setTooltip(a,r)}),r.on("finalize.legend",function(){var a=e.legend;a.translation||(a.translation=d3.translate(-o/2,-l/2)),a.data=v,a.onclick=function(e){var a=e.data.label,n=e.data.disabled;t.some(function(t){return t.label===a&&(t.disabled=!n,!0)}),r.call("init",this,g(t)),r.call("update",this,k.selectAll(".arc"))},d3.setLegend(k,a)}),r.call("init",this,v),r.call("update",this,k.selectAll(".arc")),r.call("finalize",this)}},d3.components.lineChart={type:"line chart",schema:{type:"object",entries:[{key:"x",type:"number",mappings:["year","name"]},{key:"y",type:"number",mappings:["count","percentage","ratio","value"]}]},sort:null,lines:{curve:"curveLinear",density:1,stroke:"#1f77b4",strokeWidth:1,fill:"none"},dots:{show:!1,radius:"0.5%",stroke:"#1f77b4",strokeWidth:1,fill:"#fff"},tooltip:{html:function(t){var e=d3.format(".3"),r=Number(t.x.toFixed(3)),a=Number(t.y.toFixed(3));return"x: "+e(r)+", y: "+e(a)}}},d3.lineChart=function(t,e){t=d3.parseData("lineChart",t),e=d3.parseOptions("lineChart",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width,e.height,e.innerWidth),i=e.innerHeight,o=e.margin,l=(e.stroke,e.strokeWidth,e.colorScheme,e.fontSize,e.lineHeight,e.lines),s=Math.round(n*l.density),d=e.domainX,c=e.domainY,u=d3.type(t),p=[];if("function"===u){var h=d[0],f=d[1],m=(f-h)/s;d3.range(h,f+m/2,m).forEach(function(e){var r=t(e);p.push({x:e,y:r})})}else"array"===u&&(t.sort(function(t,e){return d3.ascending(t.x,e.x)}),p=t);void 0===d&&(d=d3.extent(p,function(t){return t.x})),void 0===c&&(c=d3.extent(p,function(t){return t.y}));var g=d3.scaleLinear().domain(d).rangeRound([0,n]).nice(),y=d3.scaleLinear().domain(c).rangeRound([i,0]).nice(),v=d3.line().x(function(t){return g(t.x)}).y(function(t){return y(t.y)}).curve(d3[l.curve]);if("svg"===a){var x=d3.createPlot(r,e),k=x.select(".container").attr("transform",d3.translate(o.left,o.top));d3.setAxes(k,{width:n,height:i,scaleX:g,scaleY:y,axisX:e.axisX,axisY:e.axisY,gridX:e.gridX,gridY:e.gridY,framed:e.framed}),d3.setLabels(k,{width:n,height:i,labelX:e.labelX,labelY:e.labelY}),k.append("g").attr("class","lines").append("path").datum(p).attr("d",v).attr("stroke",l.stroke).attr("stroke-width",l.strokeWidth).attr("fill",l.fill)}var b=e.dots;b.show&&k.append("g").attr("class","dots").selectAll(".dot").data(p).enter().append("circle").attr("class","dot").attr("cx",function(t){return g(t.x)}).attr("cy",function(t){return y(t.y)}).attr("r",b.radius).attr("stroke",b.stroke).attr("stroke-width",b.strokeWidth).attr("fill",b.fill);var w=e.tooltip;w.target=k.selectAll(".dot"),d3.setTooltip(r,w)},d3.components.bubbleChart={type:"bubble chart",schema:{type:"object",entries:[{key:"x",type:"number",mappings:["category","name","year"]},{key:"y",type:"number",mappings:["count"]},{key:"z",type:"number",mappings:[]}]},offsetX:[.5,.5],offsetY:[0,0],framed:!1,axisX:{ticks:{format:d3.format("d")}},axisY:{ticks:{format:d3.format("d")}},gridX:{show:!0},dots:{scale:"2%",minRadius:4,maxRadius:1/0,normalize:"sqrt",stroke:"#fff",opacity:.8,gradient:!1,hue:160,saturation:.8,lightness:.6},tooltip:{html:function(t){return"x = "+t.x+"<br/>y = "+t.y+"<br/>z = "+t.z}}},d3.bubbleChart=function(t,e){t=d3.parseData("bubbleChart",t),e=d3.parseOptions("bubbleChart",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width,e.height,e.innerWidth),i=e.innerHeight,o=e.margin,l=(e.stroke,e.strokeWidth,e.colorScheme),s=(e.fontSize,e.lineHeight,e.offsetX),d=e.offsetY,c=d3.extent(t,function(t){return t.x}),u=d3.extent(t,function(t){return t.y}),p=d3.extent(t,function(t){return t.z}),h=c[0],f=c[1],m=u[0],g=u[1],y=p[0],v=p[1],x=d3.scaleLinear().domain(e.domainX||[h-s[0],f+s[1]]).rangeRound(e.rangeX||[0,n]),k=d3.scaleLinear().domain(e.domainY||[m-d[0],g+d[1]]).rangeRound(e.rangeY||[i,0]).nice();if("svg"===a){var b=d3.createPlot(r,e),w=b.select(".container").attr("transform",d3.translate(o.left,o.top));d3.setAxes(w,{width:n,height:i,scaleX:x,scaleY:k,axisX:e.axisX,axisY:e.axisY,gridX:e.gridX,gridY:e.gridY,framed:e.framed}),d3.setLabels(w,{width:n,height:i,labelX:e.labelX,labelY:e.labelY});var z=d3.scaleOrdinal(l),A=e.dots,S=A.scale,M=A.minRadius,O=A.maxRadius,W=A.normalize,C=A.opacity,P=A.hue,j=A.saturation,X=A.lightness,Y=w.selectAll(".dot").data(t).enter().append("circle").attr("class","dot").attr("cx",function(t){return x(t.x)}).attr("cy",function(t){return k(t.y)}).attr("r",function(t){var e=0;return O!==1/0&&O?O>M&&(e=(t.z-y)/(v-y),S=O-M):e=t.z/v,"sqrt"===W&&(e=Math.sqrt(e)),Math.round(e*S+M)}).attr("opacity",C).attr("stroke",A.stroke).attr("fill",function(t){if("function"==typeof A.color)return A.color(t);if(A.gradient){var e=P*(1-t.y/g)+(180-P),r=j*(t.y-m)/(g-m||1)+(1-j),a=X-(1-X)*(t.x-h)/(f-h||1);return d3.hsl(e,r,a)}return z(t.x)}).sort(function(t,e){return e.z-t.z});A.onclick&&Y.attr("cursor","pointer").on("click",function(t){"function"==typeof A.onclick&&A.onclick(t)});var R=e.tooltip;R.target=w.selectAll(".dot"),d3.setTooltip(r,R)}},d3.components.radarChart={type:"radar chart",schema:{type:"object",entries:[{key:"axis",type:"string",mappings:["category","label","name"]},{key:"value",type:"number",mappings:["count","percentage","ratio"]},{key:"series",type:"string",optional:!0,mappings:["group","type"]}]},sort:null,curve:"curveLinearClosed",levels:3,maxValue:0,grids:{show:!0,shape:"polygon",stroke:"#ccc",strokeWidth:1,fill:"none"},rays:{show:!0,stroke:"#999",strokeWidth:1},areas:{stroke:"#1f77b4",strokeWidth:2,fill:"#3182bd",opacity:.65},dots:{show:!0,radius:"0.5%",strokeWidth:1,fill:"#fff"},labels:{show:!0,dy:"0.25em",padding:"1em",wrapText:!1,wrapWidth:"10em",lineHeight:"1.2em",verticalAlign:"middle",fill:"currentColor"},legend:{show:null,text:function(t){return t.series}},tooltip:{html:function(t){return t.axis+": "+t.value}}},d3.radarChart=function(t,e){t=d3.parseData("radarChart",t),e=d3.parseOptions("radarChart",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=e.context,i=e.width,o=e.height,l=e.innerWidth,s=e.innerHeight,d=(e.stroke,e.strokeWidth,e.colorScheme),c=(e.fontSize,e.lineHeight,e.axes||[]),u=e.series||[],p=[],h=[];t.forEach(function(t){var e=t.axis,r=t.series;c.indexOf(e)===-1&&c.push(e),u.indexOf(r)===-1&&u.push(r),h.push(t.value)}),p=u.map(function(e){var r=t.filter(function(t){return t.series===e});return{series:e,disabled:!1,data:c.map(function(t){var e=null;return r.some(function(r){return r.axis===t&&(e=r,!0)}),null===e&&(e={axis:t,value:0}),e})}});var f=c.length,m=2*Math.PI/f,g=Math.min(l,s)/2,y=Math.max(d3.max(h),e.maxValue),v=d3.scaleLinear().range([0,g]).domain([0,y]),x=d3.radialLine().radius(function(t){return v(t.value)}).angle(function(t,e){return m*e}).curve(d3[e.curve]).context(n);if("svg"===a){var k=d3.createPlot(r,e),b=k.select(".container"),w=e.grids,z=e.levels;if(w.show){var A=w.shape;"polygon"===A?b.selectAll(".grid").data(d3.range(1,z+1)).enter().append("polygon").attr("class","grid").attr("points",function(t){var e=v(y/z*t);return d3.regularPolygon(f,e).join(" ")}).attr("stroke",w.stroke).attr("stroke-width",w.strokeWidth).attr("fill",w.fill):"circle"===A&&b.selectAll(".grid").data(d3.range(1,z+1)).enter().append("circle").attr("class","grid").attr("cx",0).attr("cy",0).attr("r",function(t){return g/z*t}).attr("stroke",w.stroke).attr("stroke-width",w.strokeWidth).attr("fill",w.fill)}var S=e.rays;S.show&&b.selectAll(".ray").data(d3.range(f)).enter().append("line").attr("class","ray").attr("x1",0).attr("y1",0).attr("x2",function(t){return g*Math.sin(m*t)}).attr("y2",function(t){return-g*Math.cos(m*t)}).attr("stroke",S.stroke).attr("stroke-width",S.strokeWidth);var M=d3.scaleOrdinal(d),O=function(t){return t.color},W=function(t){return d3.color(t.color).darker()},C=e.areas,P=e.dots,j=b.selectAll(".series").data(p).enter().append("g").attr("class","series").attr("stroke",function(t){return t.color=M(t.series),d3.color(t.color).darker()}).attr("stroke-width",C.strokeWidth).style("display",function(t){return t.disabled?"none":"block"});j.append("path").attr("class","area").attr("d",function(t){return x(t.data)}).attr("fill",O).attr("opacity",C.opacity).on("mouseover",function(){j.selectAll(".area").attr("fill","none").attr("pointer-events","none"),d3.select(this).attr("fill",W).attr("pointer-events","visible")}).on("mouseout",function(){j.selectAll(".area").attr("fill",O).attr("pointer-events","visible")});P.show&&j.selectAll(".dot").data(function(t){return t.data}).enter().append("circle").attr("class","dot").attr("cx",function(t,e){
return v(t.value)*Math.sin(m*e)}).attr("cy",function(t,e){return-v(t.value)*Math.cos(m*e)}).attr("r",P.radius).attr("stroke",P.stroke).attr("stroke-width",P.strokeWidth).attr("fill",P.fill);var X=e.labels;if(X.show){var Y=g+X.padding;b.selectAll(".label").data(c).enter().append("text").attr("class","label").attr("x",function(t,e){return Y*Math.sin(m*e)}).attr("y",function(t,e){return-Y*Math.cos(m*e)}).attr("dy",X.dy).attr("text-anchor",function(t,e){var r="middle";return e>0&&e<Math.ceil(f/2)?r="start":e>=Math.floor(f/2)+1&&(r="end"),r}).attr("fill",X.fill).text(function(t){return t}).call(d3.wrapText,X)}var R=e.legend;R.translation||(R.translation=d3.translate(-i/2,-o/2)),R.data=p,R.onclick=function(){j.style("display",function(t){return t.disabled?"none":"block"})},d3.setLegend(b,R);var I=e.tooltip;I.target=j.selectAll(".dot"),d3.setTooltip(r,I)}},d3.components.sunburstChart={type:"sunburst chart",schema:{type:"object",hierarchy:"children",entries:[{key:"label",type:"string",mappings:["category","name"]},{key:"value",type:"number",mappings:["count","percentage","ratio"]},{key:"children",type:"array"}]},sort:null,donut:{show:!1,ratio:.2,radius:20},zoomable:!0,labels:{show:!1},tooltip:{html:function(t){return t.data.label+": "+t.data.value}},stroke:"#fff",colorScheme:d3.schemeCategory20c},d3.sunburstChart=function(t,e){t=d3.parseData("sunburstChart",t),e=d3.parseOptions("sunburstChart",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=e.context,i=e.width,o=e.height,l=(e.stroke,e.strokeWidth,e.colorScheme),s=(e.fontSize,e.lineHeight,Math.min(i,o)/2),d=d3.scaleLinear().range([0,2*Math.PI]),c=d3.scaleSqrt().range([0,s]),u=d3.hierarchy(t,function(t){return t.children}).sum(function(t){return t.children?0:t.value});"function"==typeof e.sort&&u.sort(e.sort),d3.partition()(u);var p=d3.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,d(t.x0)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,d(t.x1)))}).innerRadius(function(t){return Math.max(0,c(t.y0))}).outerRadius(function(t){return Math.max(0,c(t.y1))}).context(n);if("svg"===a){var h=d3.createPlot(r,e),f=h.select(".container"),m=d3.scaleOrdinal(l),g=e.donut,y=f.selectAll(".arc").data(u.descendants()).enter().append("g").attr("class","arc").append("path").attr("d",p).attr("opacity",function(t){return g.show&&null===t.parent?0:null}).attr("fill",function(t){return m((t.children?t:t.parent).data.label)});e.zoomable&&y.attr("cursor","pointer").on("click",function(t){var e=s*g.ratio||g.radius;f.transition().tween("scale",function(){var r=d3.interpolate(d.domain(),[t.x0,t.x1]),a=d3.interpolate(c.domain(),[t.y0,1]),n=d3.interpolate(c.range(),[t.y0?e:0,s]);return function(t){d.domain(r(t)),c.domain(a(t)).range(n(t))}}).selectAll("path").attrTween("d",function(t){return function(){return p(t)}})});var v=e.tooltip;v.target=f.selectAll(".arc"),d3.setTooltip(r,v)}},d3.components.choroplethMap={type:"choropleth map",schema:{type:"object",entries:[{key:"id",type:"string",mappings:["adcode","city","code","county","country","district","name","nation","province","state"]},{key:"value",type:"number",mappings:["count","percentage","ratio"]},{key:"series",type:"string",optional:!0,mappings:["group","type"]}]},levels:5,projection:"geoMercator",coloring:"ordinal",colorScale:"scaleOrdinal",zoomable:!1,scaleExtent:[1,12],graticules:{show:!1,step:[10,10],precision:1,stroke:"#ccc"},regions:{show:!0,stroke:"#666",fill:"#fff"},tile:{show:!1,zoomable:!0,scale:512,scaleExtent:[512,262144],image:{size:256}},labels:{show:!1,dy:"0.25em",stroke:"none",fill:"#333",fontSize:"0.5em",opacity:1,text:function(t){return t.data.id}},tooltip:{html:function(t){return t.data.id+": "+t.data.value}},colorScheme:d3.schemeCategory20c},d3.choroplethMap=function(t,e){t=d3.parseData("choroplethMap",t),e=d3.parseOptions("choroplethMap",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=(e.id,e.renderer),n=(e.context,e.width),i=e.height,o=(e.stroke,e.fill),l=(e.strokeWidth,e.fontSize,e.lineHeight,e.domain||[]),s=d3.extent(t,function(t){return t.value}),d=l[0]||s[0]||0,c=l[1]||s[1]||1,u=e.map,p=e.tile,h=d3.geoMercator();p.show&&d3.tile?(e.zoomable=!1,p.size=[n,i],p.center=p.center||u.center,p.scale=Math.max(p.scale,n),h.scale(1/(2*Math.PI)).translate([0,0]).center([0,0])):h=d3[e.projection]().scale(i*u.scale).translate(u.translate||[0,0]).rotate(u.rotate||[0,0]).center(u.center);var f=d3.geoPath().projection(h),m=d3.parseGeoData(u,{data:t,neighbors:!0}),g=m.features,y=m.neighbors,v=e.coloring,x=e.colorScale,k=e.colorScheme,b=d3.scaleOrdinal(k);if("scaleSequential"===x)b=d3.scaleSequential(k);else if("scaleThreshold"===x){var w=e.thresholds||[];if(!w.length){var z=e.levels,A=(c-d)/z;w=d3.range(z).map(function(t){return A*t+d})}b=d3.scaleThreshold().domain(w).range(k)}if("svg"===a){var S=d3.createPlot(r,e),M=S.select(".container");if(p.show&&d3.tile){var O=h(p.center),W=d3.zoomIdentity.translate(n/2,i/2).scale(p.scale).translate(-O[0],-O[1]),C=d3.zoom().scaleExtent(p.scaleExtent).on("zoom",function(){var t=d3.event.transform;p.scale=t.k,p.translate=[t.x,t.y],d3.imageTiles(S.select(".tile"),p),h.scale(p.scale/(2*Math.PI)).translate(p.translate),M.selectAll(".region").attr("d",f),M.selectAll(".dot").attr("cx",function(t){return h(t.coordinates)[0]}).attr("cy",function(t){return h(t.coordinates)[1]})});M.attr("transform",d3.translate(0,0)),S.insert("g",":first-child").attr("class","tile"),S.call(C).call(C.transform,W),p.zoomable===!1&&C.on("zoom",null)}var P=e.graticules;if(P.show){var j=d3.geoGraticule().step(P.step).precision(P.precision);M.append("path").datum(j).attr("class","graticule").attr("d",f).attr("stroke",P.stroke)}var X=e.regions;if(X.show){var o=X.fill;M.append("g").attr("class","layer").selectAll(".region").data(g).enter().append("path").attr("class","region").attr("d",f).attr("stroke",X.stroke).attr("fill",function(t,e){return t.color?t.color:"none"===o?o:("topological"===v&&y.length?t.value=(0|d3.max(y[e],function(t){return g[t].value}))+1:t.value=t.data.value,void 0===t.value||null===t.value?o:("scaleSequential"===x&&(t.value=(t.value-d)/c),b(t.value)))})}var Y=e.labels;if(Y.show&&M.selectAll(".label").data(g).enter().append("text").attr("class","label").attr("x",function(t){return t.center=f.centroid(t),t.center[0]}).attr("y",function(t){return t.center[1]}).attr("dy",Y.dy).attr("text-anchor","middle").attr("stroke",Y.stroke).attr("fill",Y.fill).attr("font-size",Y.fontSize).attr("opacity",Y.opacity).text(Y.text),e.zoomable){var R=h.scale(),I=h.translate(),C=d3.zoom().scaleExtent(e.scaleExtent).on("zoom",function(t){var e=d3.event.transform;h.scale(e.k*R).translate([I[0]+e.x,I[1]+e.y]),M.selectAll(".graticule").attr("d",f),M.selectAll(".region").attr("d",f),M.selectAll(".dot").attr("cx",function(t){return h(t.coordinates)[0]}).attr("cy",function(t){return h(t.coordinates)[1]}),M.selectAll(".label").attr("x",function(t){return t.center=f.centroid(t),t.center[0]}).attr("y",function(t){return t.center[1]})});S.attr("cursor","move").call(C)}var H=e.tooltip;H.target=M.selectAll(".region"),d3.setTooltip(r,H)}},d3.components.bubbleMap={type:"bubble map",schema:{type:"object",entries:[{key:"id",type:"string",mappings:["adcode","city","code","county","country","district","name","province","state"]},{key:"value",type:"number",mappings:["count","percentage","ratio"]},{key:"lng",type:"number",mappings:["lon","longitude"]},{key:"lat",type:"number",mappings:["latitude"]}]},sort:null,projection:"geoMercator",tile:{show:!1,scale:512},dots:{scale:"0.5%",minRadius:2,maxRadius:1/0,stroke:"#fff",opacity:.8},labels:{show:!1},tooltip:{html:function(t){return t.id+": "+t.value}}},d3.bubbleMap=function(t,e){t=d3.parseData("bubbleMap",t),e=d3.parseOptions("bubbleMap",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width),i=e.height,o=(e.stroke,e.strokeWidth,e.colorScheme),l=(e.fontSize,e.lineHeight,e.domain||[]),s=d3.extent(t,function(t){return t.value}),d=l[0]||s[0]||0,c=l[1]||s[1]||1,u=e.map,p=e.tile,h=d3.geoMercator();if(p.show&&d3.tile?(p.size=[n,i],p.center=p.center||u.center,p.scale=Math.max(p.scale,n),h.scale(1/(2*Math.PI)).translate([0,0]).center([0,0])):h=d3[e.projection]().scale(i*u.scale).translate(u.translate||[0,0]).center(u.center),t=d3.parseGeoData(u,{data:t,mixin:!0}),"svg"===a){var f=d3.createPlot(r,e),m=f.select(".container");if(p.show&&d3.tile){var g=h(p.center),y=d3.zoomIdentity.translate(n/2,i/2).scale(p.scale).translate(-g[0],-g[1]),v=d3.zoom().on("zoom",function(){var t=d3.event.transform;p.scale=t.k,p.translate=[t.x,t.y],h.scale(p.scale/(2*Math.PI)).translate(p.translate),m.selectAll(".dot").attr("cx",function(t){return h(t.coordinates)[0]}).attr("cy",function(t){return h(t.coordinates)[1]})});m.call(v).call(v.transform,y),v.on("zoom",null)}var x=d3.scaleOrdinal(o),k=e.dots,b=k.scale,w=k.minRadius,z=k.maxRadius,A=(m.append("g").attr("class","layer").attr("stroke",k.stroke).attr("opacity",k.opacity).selectAll(".dot").data(t).enter().append("circle").attr("class","dot").each(function(t){t.coordinates=t.coordinates||[t.lng,t.lat]}).attr("cx",function(t){return h(t.coordinates)[0]}).attr("cy",function(t){return h(t.coordinates)[1]}).attr("r",function(t){var e=0;return z!==1/0&&z?z>w&&(e=Math.sqrt((t.value-d)/(c-d))*(z-w)):e=Math.sqrt(t.value/c)*b,e+w}).attr("fill",function(t){return x(t.value)}).sort(function(t,e){return e.value-t.value}),e.tooltip);A.target=m.selectAll(".dot"),d3.setTooltip(r,A)}},d3.components.contourPlot={type:"contour plot",schema:{type:"object",entries:[{key:"x",type:"number",mappings:["lng","longitude"]},{key:"y",type:"number",mappings:["lat","latitude"]},{key:"z",type:"number",mappings:["count","percentage","ratio","value"]}]},colorScale:"scaleOrdinal",contours:{number:10,smooth:!0,density:1},tooltip:{html:function(t){var e=Number(t.value.toFixed(3));return d3.format(".3")(e)}}},d3.contourPlot=function(t,e){t=d3.parseData("contourPlot",t),e=d3.parseOptions("contourPlot",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width,e.height,e.innerWidth),i=e.innerHeight,o=e.margin,l=(e.stroke,e.strokeWidth,e.fontSize,e.lineHeight,e.contours),s=l.density,d=l.size||[],c=d[0]||Math.round(n*s),u=d[1]||Math.round(i*s),p=l.scale||i/u,h=e.domainX,f=e.domainY,m=d3.type(t),g=[];if("function"===m){var y=1/c,v=1/u,x=h[1]-h[0],k=f[1]-f[0];d3.range(v/2,1,v).forEach(function(e){d3.range(y/2,1,y).forEach(function(r){var a=h[0]+r*x,n=f[1]-e*k;g.push(t(a,n))})})}else"array"===m&&(t.sort(function(t,e){return d3.descending(t.y,e.y)||d3.ascending(t.x,e.x)}),g=t.map(function(t){return t.z||t}));var b=d3.scaleLinear().domain(h).rangeRound([0,n]).nice(),w=d3.scaleLinear().domain(f).rangeRound([i,0]).nice(),z=d3.extent(g),A=e.thresholds;if("array"!==d3.type(A)){var S=z[0],M=z[1],O=(M-S)/l.number;A=d3.range(S,M,O)}var W=e.colorScale,C=e.colorScheme,P=d3.scaleOrdinal(C);"scaleSequential"===W&&(P=d3.scaleSequential(C).domain(z));var j=d3.contours().size([c,u]).thresholds(A).smooth(l.smooth);if("svg"===a){var X=d3.createPlot(r,e),Y=X.select(".container").attr("transform",d3.translate(o.left,o.top));Y.append("g").attr("class","contours").attr("transform",function(){var t=n/i/(c/u);return 1===t?null:"scale("+t+",1)"}).selectAll("path").data(j(g)).enter().append("path").attr("class","contour").attr("d",d3.geoPath(d3.geoIdentity().scale(p))).attr("fill",function(t){return P(t.value)}).attr("stroke",l.stroke),d3.setAxes(Y,{width:n,height:i,scaleX:b,scaleY:w,axisX:e.axisX,axisY:e.axisY,gridX:e.gridX,gridY:e.gridY,framed:e.framed});var R=e.tooltip;R.target=Y.selectAll(".contour"),d3.setTooltip(r,R)}},d3.components.mosaicPlot={type:"mosaic plot",schema:{type:"object",entries:[{key:"column",type:"string",mappings:["category"]},{key:"row",type:"string",mappings:["year"]},{key:"value",type:"number",mappings:["count","percentage","ratio"]},{key:"series",type:"string",optional:!0,mappings:["group","type"]}]},coloring:"series",scaleX:{uniform:!1,paddingInner:.1,paddingOuter:0,paddingMidst:0},scaleY:{uniform:!1,paddingInner:.1,paddingOuter:0},scaleZ:{uniform:!1,independent:!1,paddingMidst:0},labels:{show:!1,stroke:"none",fill:"#fff",fontSize:"3%",minWidth:"6%",minHeight:"3%",text:function(t){return t.value}},tooltip:{html:function(t){var e="column = "+t.column+"<br/>row = "+t.row;return t.series&&(e+="<br/>series = "+t.series),e+"<br/>value = "+t.value}}},d3.mosaicPlot=function(t,e){t=d3.parseData("mosaicPlot",t),e=d3.parseOptions("mosaicPlot",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width,e.height,e.innerWidth),i=e.innerHeight,o=e.margin,l=e.stroke,s=(e.strokeWidth,e.colorScheme),d=(e.fontSize,e.lineHeight),c=e.rows||[],u=e.columns||[],p=e.series||[];c.length||(c=d3.set(t,function(t){return t.row}).values()),u.length||(u=d3.set(t,function(t){return t.column}).values()),p.length||(p=d3.set(t,function(t){return t.series}).values());var h=e.scaleX,f=e.scaleY,m=e.scaleZ,g=d3.scaleBand().domain(u).range([0,n]).paddingInner(h.paddingInner).paddingOuter(h.paddingOuter),y=d3.scaleBand().domain(c).range([0,i]).paddingInner(f.paddingInner).paddingOuter(f.paddingOuter),v=d3.map(),x=h.uniform;if(!x){var k=0,b=u.map(function(e){return d3.sum(t,function(t){return t.column===e?t.value:0})}),w=d3.mean(b);u.forEach(function(t,e){var r=b[e]/w;v.set(t,{ratio:r,offset:k}),k+=r-1})}var z=d3.map(),A=f.uniform,S=m.uniform,M=m.independent;if(!A){var O=0,W=0,C=c.map(function(e){return d3.sum(t,function(t){return t.row===e?t.value:0})}),P=d3.mean(C);c.forEach(function(e,r){var a=C[r]/P,n=t.filter(function(t){return t.row===e}),i=p.map(function(t){return d3.sum(n,function(e){return String(e.series)===t?e.value:0})}),o=d3.mean(i);p.forEach(function(t,r){var n=a*(S?1:i[r]/o);z.set(e+"."+t,{ratio:n,offset:O}),O+=n-1}),0===r&&(W=O),M||u.forEach(function(t){var r=W-O,i=n.filter(function(e){return e.column===t}),o=p.map(function(t){return d3.sum(i,function(e){return String(e.series)===t?e.value:0})}),l=d3.mean(o);p.forEach(function(n,i){var s=a*(S?1:o[i]/l);z.set(e+"."+t+"."+n,{ratio:s,offset:r}),r+=s-1})})})}var j=e.coloring,X=d3.scaleOrdinal().range(s);if("row"===j?X.domain(c):"column"===j?X.domain(u):"series"===j&&X.domain(p),"svg"===a){var Y=d3.createPlot(r,e),R=Y.select(".container").attr("transform",d3.translate(o.left,o.top)),I=g.bandwidth(),H=y.bandwidth()/p.length,D=H*m.paddingMidst;R.selectAll(".mosaic").data(t).enter().append("g").attr("class","mosaic").attr("transform",function(t){var e=p.indexOf(t.series),r=(M?"":"."+t.column)+"."+t.series,a=x?0:v.get(t.column).offset,n=A?0:z.get(t.row+r).offset;return t.x=t.x||g(t.column)+I*a,t.y=t.y||y(t.row)+H*n,e!==-1&&(t.y+=(H+D)*e),d3.translate(t.x,t.y)}).append("rect").attr("x",0).attr("y",0).attr("width",function(t){var e=x?1:v.get(t.column).ratio;return t.width=t.width||I*e,t.width}).attr("height",function(t){var e=(M?"":"."+t.column)+"."+t.series,r=A?1:z.get(t.row+e).ratio;return t.height=(t.height||H*r)-D,t.height}).attr("stroke",l).attr("fill",function(t){return t.color=t.color||X(t[j]),t.color});var T=e.labels;if(T.show){var L=T.minWidth,E=T.minHeight;R.selectAll(".mosaic").append("text").attr("x",function(t){return t.width/2}).attr("y",function(t){return t.height/2+d/4}).attr("text-anchor","middle").attr("stroke",T.stroke).attr("fill",T.fill).attr("font-size",T.fontSize).attr("display",function(t){return t.width<L||t.height<E?"none":"block"}).text(T.text)}var N=e.tooltip;N.target=R.selectAll(".mosaic"),d3.setTooltip(r,N)}},d3.components.terrestrialGlobe={type:"terrestrial globe",schema:{type:"object",entries:[{key:"id",type:"string",mappings:["country","nation"]},{key:"value",type:"number",mappings:["count","percentage","ratio"]},{key:"series",type:"string",optional:!0,mappings:["group","type"]}]},levels:5,projection:"geoOrthographic",coloring:"ordinal",colorScale:"scaleOrdinal",sphere:{show:!0,stroke:"none",fill:"#1f77b4"},graticules:{show:!1,step:[10,10],precision:1,stroke:"#ccc"},regions:{show:!0,stroke:"#666",fill:"#fff"},tooltip:{html:function(t){return t.data.id+": "+t.data.value}},rotation:{enable:!0,autoplay:!1,sensitivity:.25,velocity:[.01,0,0]},colorScheme:d3.schemeCategory20c},d3.terrestrialGlobe=function(t,e){t=d3.parseData("terrestrialGlobe",t),e=d3.parseOptions("terrestrialGlobe",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=(e.id,e.renderer),n=(e.context,e.width),i=e.height,o=(e.stroke,e.fill),l=(e.strokeWidth,e.fontSize,e.lineHeight,e.map),s=l.center||[0,0],d=Math.min(n,i)/2,c=d3[e.projection]().scale(l.scale*d).translate(l.translate||[0,0]).rotate(l.rotate||[-s[0],-s[1]]).clipAngle(90),u=d3.geoPath().projection(c),p=d3.parseGeoData(l,{data:t,neighbors:!0}),h=p.features,f=p.neighbors,m=e.coloring,g=e.colorScale,y=e.colorScheme,v=d3.scaleOrdinal(y);if("scaleSequential"===g)v=d3.scaleSequential(y);else if("scaleThreshold"===g){var x=e.thresholds||[];if(!x.length){var k=e.levels,b=(max-min)/k;x=d3.range(k).map(function(t){return b*t+min})}v=d3.scaleThreshold().domain(x).range(y)}if("svg"===a){var w=d3.createPlot(r,e),z=w.select(".container"),A=e.sphere;A.show&&z.append("g").attr("class","layer").append("path").datum({type:"Sphere"}).attr("class","sphere").attr("d",u).attr("stroke",A.stroke).attr("stroke-width",A.strokeWidth).attr("fill",A.fill);var S=e.graticules;if(S.show){var M=d3.geoGraticule().step(S.step).precision(S.precision);z.append("g").attr("class","layer").append("path").datum(M).attr("class","graticule").attr("d",u).attr("stroke",S.stroke).attr("fill","none")}var O=e.regions;if(O.show){var o=O.fill;z.append("g").attr("class","layer").selectAll(".region").data(h).enter().append("path").attr("class","region").attr("d",u).attr("stroke",O.stroke).attr("fill",function(t,e){return t.color?t.color:"none"===o?o:("topological"===m&&f.length?t.value=(0|d3.max(f[e],function(t){return h[t].value}))+1:t.value=t.data.value,void 0===t.value||null===t.value?o:("scaleSequential"===g&&(t.value=(t.value-min)/max),v(t.value)))})}var W=e.rotation;if(W.enable)if(W.autoplay){var C=W.velocity;d3.timer(function(t){var e=C.map(function(e){return e*t});c.rotate(e),z.selectAll(".graticule").attr("d",u),z.selectAll(".region").attr("d",u)})}else{var P=W.sensitivity,j=d3.drag().subject(function(){var t=c.rotate();return{x:t[0]/P,y:-t[1]/P}}).on("drag",function(){var t=[d3.event.x*P,-d3.event.y*P,c.rotate()[2]];c.rotate(t),z.selectAll(".graticule").attr("d",u),z.selectAll(".region").attr("d",u)});z.select(".sphere").call(j)}var X=e.tooltip;X.target=z.selectAll(".region"),d3.setTooltip(r,X)}},d3.components.timelineDiagram={type:"timeline diagram",schema:{type:"object",entries:[{key:"date",type:"date",mappings:["time","year"]},{key:"text",type:"string",mappings:["content","info","name"]},{key:"img",type:"string",mappings:["icon","image","picture","photo"]}]},sort:"ascending(date)",scale:"scaleTime",axis:{show:!0,label:!0,nice:!1,format:"%Y",stroke:"currentColor",strokeWidth:1,fill:"currentColor",fontSize:"0.5em",domain:{show:!0,stroke:"currentColor",strokeWidth:1},ticks:{number:8,sizeInner:0,sizeOuter:0,padding:4,format:""}},items:{stroke:"currentColor",strokeWidth:1,fill:"currentColor",fontSize:"0.65em"},connectors:{dx:0,dy:"3.5%",stroke:"currentColor",strokeWidth:1},knots:{radius:"0.5%",stroke:"#1f77b4",strokeWidth:1,fill:"#fff"},images:{maxWidth:"6%",maxHeight:"6%"},tooltip:{html:function(t){return d3.timeFormat("%Y-%m-%d")(t.date)}}},d3.timelineDiagram=function(t,e){t=d3.parseData("timelineDiagram",t),e=d3.parseOptions("timelineDiagram",e);var r=(d3.dispatch("init","update","finalize"),e.chart),a=e.renderer,n=(e.context,e.width,e.height,e.innerWidth),i=e.innerHeight,o=e.margin,l=(e.stroke,e.strokeWidth,e.colorScheme),s=e.fontSize,d=e.lineHeight,c=e.domain;Array.isArray(c)&&c.length?(c=c.map(function(t){return new Date(t)}),t=t.filter(function(t){return t.date>=c[0]&&t.date<c[1]})):c=d3.extent(t,function(t){return t.date}),"function"===d3.type(e.sort)&&t.sort(e.sort),"scalePoint"===e.scale&&(c=t.map(function(t){return t.date}));var u=e.axis,p=d3[e.scale]().domain(c).rangeRound([0,n]);if(u.nice&&p.nice(),"svg"===a){var h=d3.createPlot(r,e),f=h.select(".container").attr("transform",d3.translate(o.left,o.top)),m=e.origin||[0,i/2],g=m[0],y=m[1];if(d3.setAxes(f,{width:n,height:y,scaleX:p,axisX:u}),u.label){var v=d3.timeFormat(u.format);f.append("text").attr("class","label").attr("x",g-s/2).attr("y",y+d/8).attr("font-size",u.fontSize).attr("fill",u.fill).attr("text-anchor","end").text(v(c[0])),f.append("text").attr("class","label").attr("x",n+s/2).attr("y",y+d/8).attr("font-size",u.fontSize).attr("fill",u.fill).attr("text-anchor","start").text(v(c[1]))}var x=e.items,k=e.images,b=k.maxWidth,w=k.maxHeight,z=e.connectors,A=z.dx,S=z.dy,M=[0,0],O=[S,S];f.selectAll(".item").data(t).enter().append("g").attr("class","item").attr("transform",function(t,e){var r=e%2,a=p(t.date),n=O[r];return t.width=w*(t.width/t.height)||b,t.height=Math.min(t.height||1/0,w),e>1&&M[r]+t.width>a?n+=2*S+t.height:n=S,M[r]=a,O[r]=n,t.dx=t.hasOwnProperty("dx")?Number(t.dx):A*(n>S?n/S:1),t.dy=t.hasOwnProperty("dy")?Number(t.dy):r?n:-n,d3.translate(a,y)}),f.selectAll(".item").append("line").attr("class","connector").attr("x1",0).attr("y1",0).attr("x2",function(t){return t.dx}).attr("y2",function(t){return t.dy}).attr("stroke",z.stroke).attr("stroke-width",z.strokeWidth),f.selectAll(".item").append("image").attr("href",function(t){return t.img}).attr("x",function(t){return t.dx-t.width/2}).attr("y",function(t){return t.dy+(t.dy>0?d:-t.height-d)}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}),f.selectAll(".item").append("text").attr("x",function(t){return t.dx}).attr("y",function(t){return t.dy+d/(t.dy>0?2:-4)}).attr("font-size",x.fontSize).attr("fill",x.fill).attr("text-anchor","middle").text(function(t){return t.text});var W=e.knots,C=W.multicolor;f.selectAll(".item").append("circle").attr("class","knot").attr("cx",0).attr("cy",0).attr("r",W.radius).attr("stroke",function(t,e){return(C?t.color||l[e]:null)||W.stroke}).attr("stroke-width",W.strokeWidth).attr("fill",function(t,e){return(C?t.color||l[e]:null)||W.fill});var P=e.tooltip;P.target=f.selectAll(".knot"),d3.setTooltip(r,P)}};