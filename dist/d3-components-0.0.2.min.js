/*! D3 Components v0.0.2 | (c) 2016 Zan Pan | MIT license */
d3.components={},d3.defaultOptions={id:"chart",renderer:"svg",responsive:!0,width:300,aspectRatio:.618034,color:"#1f77b4",colorScheme:d3.schemeCategory10,stroke:"none",strokeWidth:1,fontSize:14,lineHeight:20},d3.parseData=function(t,e){if(Array.isArray(e)){e=e.filter(function(t){return null!==t&&void 0!==t}).map(function(e,r){return Array.isArray(e)?d3.parseData(t,e):"object"!=typeof e?{index:String(r),value:e}:e});var r=d3.components[t],n=r.schema||{};if("object"===n.type){var a=n.entries;e=e.map(function(t){var e=Object.keys(t);return a.forEach(function(r){var n=r.key,a=r.type;if(!t.hasOwnProperty(n)){var i=null;if(r.mappings.some(function(t){return e.indexOf(t)!==-1&&(i=t,!0)}),null===i&&e.some(function(e){return typeof t[e]===a&&(i=e,!0)}),i){var o=t[i];"number"===a&&(o=Number(o)),t[n]=o}}}),t})}}return e},d3.parseOptions=function(t,e){var r=d3.components[t];for(var n in r)r.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=r[n]);var a=d3.defaultOptions,i=e.id||a.id,o=d3.select("#"+i);if(a.responsive&&!e.hasOwnProperty("responsive")){if(!e.hasOwnProperty("width")){var s=parseInt(o.style("width"))||a.width;e.width=Math.round(s)}if(!e.hasOwnProperty("height")){var l=e.aspectRatio||a.aspectRatio,c=parseInt(o.style("height"))||e.width*l;e.height=Math.round(c)}e.hasOwnProperty("fontSize")||(e.fontSize=parseInt(o.style("font-size"))),e.hasOwnProperty("lineHeight")||(e.lineHeight=parseInt(o.style("line-height")))}for(var n in a)a.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=a[n]);e.canvas=o;var p=o.node();return"CANVAS"===p.tagName&&(e.renderer="canvas",o=p),"canvas"===e.renderer?("CANVAS"!==p.tagName&&(o=document.createElement("canvas"),p.appendChild(o)),o.width=e.width,o.height=e.height,e.context=o.getContext("2d")):e.context=null,e},d3.components.pieChart={type:"pie",schema:{type:"object",entries:[{key:"label",type:"string",mappings:["category","name"]},{key:"value",type:"number",mappings:["count","percentage"]}]},sort:null,maxRatio:.8,innerRadius:0,labels:{show:!1,fill:"#fff",minAngle:Math.PI/12,text:function(t){return t.data.label}},legend:{show:!0,text:function(t){return t.data.label}},tooltip:{show:!0,fill:"#fff",text:function(t){return t.data.label}}},d3.pieChart=function(t,e){t=d3.parseData("pieChart",t),e=d3.parseOptions("pieChart",e);var r=e.renderer,n=e.canvas,a=e.context,i=e.width,o=e.height,s=e.sort,l=e.stroke,c=e.strokeWidth,p=e.colorScheme,d=e.lineHeight,h=e.maxRatio,u=e.innerRadius,f=e.outerRadius||Math.min(i,o)/2;"number"==typeof u&&"number"==typeof f&&(u=Math.min(u,f*h));var y=d3.pie().sort(s).value(function(t){return t.value})(t),v=d3.arc().innerRadius(u).outerRadius(f).context(a);if("svg"===r){var g="translate("+i/2+","+o/2+")",m=n.append("svg").attr("width",i).attr("height",o),w=m.append("g").attr("transform",g).attr("stroke",l).attr("stroke-width",c),x=d3.scaleOrdinal(p),b=(w.selectAll(".arc").data(y).enter().append("g").attr("class","arc").append("path").attr("d",v).attr("fill",function(t){return x(t.data.label)}),e.labels);b.show&&w.selectAll(".arc").append("text").attr("x",function(t){return v.centroid(t)[0]}).attr("y",function(t){return v.centroid(t)[1]}).attr("text-anchor","middle").attr("fill",b.fill).text(b.text).style("opacity",function(t){var e=t.endAngle-t.startAngle;return e>=b.minAngle?1:0});var O=e.legend;O.show&&m.append("g").attr("class","legend").selectAll("text").data(y).enter().append("text").text(O.text).attr("y",function(t,e){return d*(e+1)}).attr("fill",function(t){return x(t.data.label)});var A=e.tooltip;A.show&&w.style("cursor","pointer").selectAll(".arc").on("mouseover",function(t){var e=d3.mouse(this);w.append("text").attr("class","tooltip").attr("x",e[0]).attr("y",e[1]).attr("fill",A.fill).text(function(){return A.text(t)})}).on("mouseout",function(){w.select(".tooltip").remove()})}else"canvas"===r&&(a.translate(i/2,o/2),y.forEach(function(t,e){a.beginPath(),v(t),a.fillStyle=p[e],a.fill(),a.closePath()}),"none"!==l&&(a.beginPath(),y.forEach(v),a.strokeStyle=l,a.lineWidth=c,a.stroke(),a.closePath()))};