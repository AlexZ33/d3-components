/*! D3 Components v0.0.2 | (c) 2016 Zan Pan | MIT license */
d3.components={},d3.defaultOptions={id:"chart",renderer:"svg",responsive:!0,width:300,aspectRatio:.618034,color:"#1f77b4",colorScheme:d3.schemeCategory10,textColor:"#333",disabledTextColor:"#ccc",stroke:"none",strokeWidth:1,fontSize:14,lineHeight:20,tooltip:{style:{display:"none",boxSizing:"border-box",position:"absolute",pointerEvents:"none",padding:"0.2em 0.6em",backgroundColor:"#fff",border:"1px solid #999",borderRadius:"0.2em",opacity:.8}}},d3.parseData=function(t,e){if(Array.isArray(e)){e=e.filter(function(t){return null!==t&&void 0!==t}).map(function(e,r){return Array.isArray(e)?d3.parseData(t,e):"object"!==d3.type(e)?{index:String(r),value:e}:e});var r=d3.components[t],a=r.schema||{};if("object"===a.type){var n=a.entries;e=e.map(function(t){var e=Object.keys(t);return n.forEach(function(r){var a=r.key,n=r.type;if(!t.hasOwnProperty(a)){var i=null;if(r.mappings.some(function(t){return e.indexOf(t)!==-1&&(i=t,!0)}),null===i&&e.some(function(e){return d3.type(t[e])===n&&(i=e,!0)}),i){var o=t[i];"number"===n?o=Number(o):"date"===n&&(o=new Date(o)),t[a]=o}}}),t})}}return e},d3.parseOptions=function(t,e){var r=d3.components[t];e=d3.extend(r,e);var a=d3.defaultOptions,n=e.id||a.id,i=d3.select("#"+n);if(a.responsive&&!e.hasOwnProperty("responsive")){if(!e.hasOwnProperty("width")){var o=parseInt(i.style("width"))||a.width;e.width=Math.round(o)}if(!e.hasOwnProperty("height")){var l=e.aspectRatio||a.aspectRatio,d=parseInt(i.style("height"))||e.width*l;e.height=Math.round(d)}e.hasOwnProperty("fontSize")||(e.fontSize=parseInt(i.style("font-size"))),e.hasOwnProperty("lineHeight")||(e.lineHeight=parseInt(i.style("line-height")))}e=d3.extend(a,e);var s=e.fontSize,p=e.lineHeight,c=d3.extend({top:p,right:2*s,bottom:2*p,left:4*s},e.margin);e.margin=c,e.innerWidth=e.width-c.left-c.right,e.innerHeight=e.height-c.top-c.bottom;var h=i.node(),u=d3.extend({id:n+"-tooltip"},e.tooltip);if(e.tooltip=u,h.style.position="relative",u.show){var f=u.id,y=u.style,m=d3.select("#"+f).node();if(null===m){m=document.createElement("div"),m.id=f,m.className="tooltip";for(var g in y)y.hasOwnProperty(g)&&(m.style[g]=y[g]);"CANVAS"===h.tagName?h.parentNode.insertBefore(m,h):h.appendChild(m)}}e.chart=h,"CANVAS"===h.tagName&&(e.renderer="canvas",i=h),"canvas"===e.renderer?("CANVAS"!==h.tagName&&(i=document.createElement("canvas"),h.appendChild(i)),i.width=e.width,i.height=e.height,e.context=i.getContext("2d")):e.context=null;for(var g in e)e.hasOwnProperty(g)&&(e[g]=d3.parseValue(e[g],e));return e},d3.parseValue=function(t,e){var r=d3.type(t);if("object"===r)for(var a in t)t.hasOwnProperty(a)&&(t[a]=d3.parseValue(t[a],e));else if("string"===r)if(/^\d+\.?\d*(px)$/.test(t))t=Number(t.replace("px",""));else if(/^\d+\.?\d*(em)$/.test(t))e.hasOwnProperty("fontSize")&&(t=Number(t.replace("em",""))*e.fontSize);else if(/^\d+\.?\d*\%$/.test(t))e.hasOwnProperty("width")&&(t=Number(t.replace("%",""))*e.width/100);else if(/^(a|de)scending\(\w+\)$/.test(t)){var n=t.split(/\W/),i=n[0],a=n[1];t=function(t,e){return t.hasOwnProperty(a)&&e.hasOwnProperty(a)?d3[i](t[a],e[a]):t.data&&e.data?d3[i](t.data[a],e.data[a]):0}}return t},d3.type=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},d3.extend=function(t,e){var r={};if("object"===d3.type(t))for(var a in t)if(t.hasOwnProperty(a)){var n=t[a];"object"===d3.type(n)&&(n=d3.extend(r[a],n)),r[a]=n}if("object"===d3.type(e))for(var a in e)if(e.hasOwnProperty(a)){var n=e[a];"object"===d3.type(n)&&(n=d3.extend(r[a],n)),r[a]=n}return r},d3.translate=function(t,e){return"translate("+t+","+e+")"},d3.components.pieChart={type:"pie chart",schema:{type:"object",entries:[{key:"label",type:"string",mappings:["category","name"]},{key:"value",type:"number",mappings:["count","percentage"]}]},sort:null,maxRatio:.8,donutRatio:0,innerRadius:0,labels:{show:!1,fill:"#fff",minAngle:Math.PI/12,text:function(t){return t.data.label}},legend:{show:!0,symbol:{width:"1.294427em",height:"0.8em"},text:function(t){return t.data.label}},tooltip:{show:!0,html:function(t){var e=(t.endAngle-t.startAngle)/(2*Math.PI);return t.data.label+": "+d3.format(".1%")(e)}}},d3.pieChart=function(t,e){t=d3.parseData("pieChart",t),e=d3.parseOptions("pieChart",e);var r=e.chart,a=e.renderer,n=e.context,i=e.width,o=e.height,l=e.innerWidth,d=e.innerHeight,s=e.stroke,p=e.strokeWidth,c=e.colorScheme,h=e.fontSize,u=e.lineHeight,f=e.maxRatio,y=e.donutRatio,m=e.outerRadius||Math.min(l,d)/2,g=e.innerRadius||m*y;"number"===d3.type(g)&&"number"===d3.type(m)&&(g=Math.min(g,m*f));var v=e.sort,b=d3.pie().sort(v).value(function(t){return t.disabled?0:t.value})(t),w=d3.arc().innerRadius(g).outerRadius(m).context(n);if("svg"===a){var x=d3.select(r).append("svg").attr("width",i).attr("height",o),O=e.position||d3.translate(i/2,o/2),P=x.append("g").attr("class","pie").attr("transform",O).attr("stroke",s).attr("stroke-width",p),A=d3.scaleOrdinal(c),C=function(t){return A(t.data.label)},S=(P.selectAll(".arc").data(b).enter().append("g").attr("class","arc").append("path").attr("d",w).attr("fill",C),e.labels);S.show&&P.selectAll(".arc").append("text").attr("class","label").attr("x",function(t){return w.centroid(t)[0]}).attr("y",function(t){return w.centroid(t)[1]}).attr("text-anchor","middle").attr("fill",S.fill).text(S.text).style("opacity",function(t){var e=t.endAngle-t.startAngle;return e>=S.minAngle?1:0});var k=e.legend;if(k.show){var R=k.position,N=k.symbol,j=Math.round(N.width),z=Math.round(N.height),I=e.textColor,M=e.disabledTextColor,H=x.append("g").attr("class","legend").attr("transform",R).style("cursor","pointer").selectAll(".legend-item").data(b).enter().append("g").attr("class",function(t){return"legend-item"+(t.data.disabled?" disabled":"")});H.append("rect").attr("width",j).attr("height",z).attr("x",0).attr("y",function(t,e){return u*(e+1)-z}).attr("fill",function(t){return t.data.disabled?M:A(t.data.label)}),H.append("text").text(k.text).attr("x",j+h/4).attr("y",function(t,e){return u*(e+1)}).attr("fill",function(t){return t.data.disabled?M:I}),H.on("click",function(r){var a=r.data.label,n=r.data.disabled;t.some(function(t){return t.label===a&&(t.disabled=!n,!0)}),x.remove(),d3.pieChart(t,e)})}var E=e.tooltip;if(E.show){var V=d3.select("#"+E.id);P.selectAll(".arc").on("mouseover",function(t){var e=d3.mouse(r);d3.select(this).select("path").attr("fill",d3.color(A(t.data.label)).darker()),V.attr("class","tooltip").style("display","block"),V.html(E.html(t)).style("left",e[0]+"px").style("top",e[1]+"px")}).on("mousemove",function(t){var e=d3.mouse(r),a=parseInt(V.style("width"))/2,n=parseInt(V.style("height"))+u/6;V.style("left",e[0]-a+"px").style("top",e[1]-n+"px")}).on("mouseout",function(){d3.select(this).select("path").attr("fill",C),V.style("display","none")})}}else"canvas"===a&&(n.translate(i/2,o/2),b.forEach(function(t,e){n.beginPath(),w(t),n.fillStyle=c[e],n.fill(),n.closePath()}),"none"!==s&&(n.beginPath(),b.forEach(w),n.strokeStyle=s,n.lineWidth=p,n.stroke(),n.closePath()))};