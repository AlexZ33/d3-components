/*! D3 Components v0.0.2 | (c) 2017 Zan Pan | MIT license */
d3.components={},d3.defaultOptions={id:"chart",renderer:"svg",responsive:!0,width:300,aspectRatio:.618034,color:"#1f77b4",colorScheme:d3.schemeCategory10,textColor:"#333",disabledTextColor:"#ccc",stroke:"none",strokeWidth:1,fontSize:14,lineHeight:20,tooltip:{style:{display:"none",boxSizing:"border-box",position:"absolute",pointerEvents:"none",padding:"0.2em 0.6em",backgroundColor:"#fff",border:"1px solid #999",borderRadius:"0.2em",fontSize:"85%",opacity:.8}}},d3.parseData=function(t,e){var r=d3.components[t],a=r.schema||{},n=a.hierarchy;if(Array.isArray(e)){if(e=e.filter(function(t){return null!==t&&void 0!==t}).map(function(e,r){return Array.isArray(e)?d3.parseData(t,e):"object"!==d3.type(e)?{index:String(r),value:e}:e}),"object"===a.type){var i=a.entries;e=e.map(function(e){var r=Object.keys(e);return i.forEach(function(a){var i=a.key,o=a.type;if(e.hasOwnProperty(i))i===n&&"array"===o&&(e[n]=d3.parseData(t,e[n]));else{var s=null,l=a.mappings||[];if(l.some(function(t){var e=r.indexOf(t);return e!==-1&&(r.splice(e,1),s=t,!0)}),null===s&&r.some(function(t){return d3.type(e[t])===o&&(s=t,!0)}),s){var d=e[s];"string"===o?d=String(d):"number"===o?d=Number(d):"date"===o&&(d=new Date(d)),e[i]=d}}}),e})}}else e=d3.parseData(t,[e])[0];return e},d3.parseOptions=function(t,e){var r=d3.components[t];e=d3.extend(r,e);var a=d3.defaultOptions,n=e.id||a.id,i=d3.select("#"+n);if(a.responsive&&!e.hasOwnProperty("responsive")){if(!e.hasOwnProperty("width")){var o=parseInt(i.style("width"))||a.width;e.width=Math.round(o)}if(!e.hasOwnProperty("height")){var s=e.aspectRatio||a.aspectRatio,l=parseInt(i.style("height"))||e.width*s;e.height=Math.round(l)}e.hasOwnProperty("fontSize")||(e.fontSize=parseInt(i.style("font-size"))),e.hasOwnProperty("lineHeight")||(e.lineHeight=parseInt(i.style("line-height")))}e=d3.extend(a,e);var d=e.fontSize,c=e.lineHeight,p=d3.extend({top:c,right:2*d,bottom:2*c,left:4*d},e.margin);e.margin=p,e.innerWidth=e.width-p.left-p.right,e.innerHeight=e.height-p.top-p.bottom;var h=i.node(),u=d3.extend({id:n+"-tooltip"},e.tooltip);if(e.tooltip=u,h.style.position="relative",u.show){var f=u.id,m=u.style,g=d3.select("#"+f).node();if(null===g){g=document.createElement("div"),g.id=f,g.className="tooltip";for(var y in m)m.hasOwnProperty(y)&&(g.style[y]=m[y]);"CANVAS"===h.tagName?h.parentNode.insertBefore(g,h):h.appendChild(g)}}e.chart=h,"CANVAS"===h.tagName&&(e.renderer="canvas",i=h),"canvas"===e.renderer?("CANVAS"!==h.tagName&&(i=document.createElement("canvas"),h.appendChild(i)),i.width=e.width,i.height=e.height,e.context=i.getContext("2d")):e.context=null;for(var y in e)e.hasOwnProperty(y)&&(e[y]=d3.parseValue(e[y],e));if(e.hasOwnProperty("map")){var b=e.map||{},x=b.name||"world";e.map=d3.extend(d3.maps[x],b)}return e},d3.parseValue=function(t,e){var r=d3.type(t);if("object"===r)for(var a in t)t.hasOwnProperty(a)&&(t[a]=d3.parseValue(t[a],e));else if("string"===r)if(/^\d+\.?\d*(px)$/.test(t))t=Number(t.replace("px",""));else if(/^\d+\.?\d*(em)$/.test(t))e.hasOwnProperty("fontSize")&&(t=Number(t.replace("em",""))*e.fontSize);else if(/^\d+\.?\d*\%$/.test(t))e.hasOwnProperty("width")&&(t=Number(t.replace("%",""))*e.width/100);else if(/^(a|de)scending\(\w+\)$/.test(t)){var n=t.split(/\W/),i=n[0],a=n[1];t=function(t,e){return t.hasOwnProperty(a)&&e.hasOwnProperty(a)?d3[i](t[a],e[a]):t.data&&e.data?d3[i](t.data[a],e.data[a]):0}}return t},d3.type=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},d3.extend=function(t,e){var r={};if("object"===d3.type(t))for(var a in t)if(t.hasOwnProperty(a)){var n=t[a];"object"===d3.type(n)&&(n=d3.extend(r[a],n)),r[a]=n}if("object"===d3.type(e))for(var a in e)if(e.hasOwnProperty(a)){var n=e[a];"object"===d3.type(n)&&(n=d3.extend(r[a],n)),r[a]=n}return r},d3.translate=function(t,e){return"translate("+t+","+e+")"},d3.setAxis=function(t,e){var r=d3.axisBottom(t),a=e.orient;return"top"===a?r=d3.axisTop(t):"left"===a?r=d3.axisLeft(t):"right"===a&&(r=d3.axisRight(t)),r.ticks(e.ticks).tickSizeInner(e.tickSizeInner).tickSizeOuter(e.tickSizeOuter).tickPadding(e.tickPadding),""!==e.tickFormat?r.tickFormat(d3.format(e.tickFormat)):r.tickFormat(""),r},d3.getMap=function(t,e){e="function"==typeof e?e:function(){};var r=t.data,a=d3.type(r);return"object"===a?e(r):("string"===a&&/(geo|topo)\.?json$/.test(r)&&(a="json"),void("json"===a&&d3.json(r,function(r){var a=r.features||[],n=[];if(window.topojson&&t.object){var i=r.objects[t.object];a=topojson.feature(r,i).features,n=topojson.neighbors(i.geometries)}return e({features:a.map(function(t,e){return t.hasOwnProperty("id")||(t.id=String(t.properties.id||e)),t}),neighbors:n})})))},d3.maps={world:{center:[0,0],scale:.25},china:{center:[103.3886,35.5636],scale:1}},d3.components.barChart={type:"bar chart",schema:{type:"object",entries:[{key:"label",type:"string",mappings:["category","name"]},{key:"value",type:"number",mappings:["count","percentage"]}]},sort:null,labels:{show:!1},tooltip:{show:!0,html:function(t,e){return"Datum "+e}}},d3.barChart=function(t,e){t=d3.parseData("barChart",t),e=d3.parseOptions("barChart",e);var r=e.chart,a=e.renderer,n=(e.context,e.width),i=e.height,o=(e.innerWidth,e.innerHeight,e.stroke),s=e.strokeWidth,l=e.colorScheme;e.fontSize,e.lineHeight;if("svg"===a){var d=d3.select(r).append("svg").attr("width",n).attr("height",i),c=e.position||d3.translate(n/2,i/2);d.append("g").attr("class","bar").attr("transform",c).attr("stroke",o).attr("stroke-width",s),d3.scaleOrdinal(l)}},d3.components.pieChart={type:"pie chart",schema:{type:"object",entries:[{key:"label",type:"string",mappings:["category","name"]},{key:"value",type:"number",mappings:["count","percentage"]}]},sort:null,maxRatio:.8,donutRatio:0,innerRadius:0,labels:{show:!1,fill:"#fff",minAngle:Math.PI/12,text:function(t){return t.data.label}},legend:{show:!0,symbol:{width:"1.294427em",height:"0.8em"},text:function(t){return t.data.label}},tooltip:{show:!0,html:function(t){var e=(t.endAngle-t.startAngle)/(2*Math.PI);return t.data.label+": "+d3.format(".1%")(e)}}},d3.pieChart=function(t,e){t=d3.parseData("pieChart",t),e=d3.parseOptions("pieChart",e);var r=e.chart,a=e.renderer,n=e.context,i=e.width,o=e.height,s=e.innerWidth,l=e.innerHeight,d=e.stroke,c=e.strokeWidth,p=e.colorScheme,h=e.fontSize,u=e.lineHeight,f=e.maxRatio,m=e.donutRatio,g=e.outerRadius||Math.min(s,l)/2,y=e.innerRadius||g*m;"number"===d3.type(y)&&"number"===d3.type(g)&&(y=Math.min(y,g*f));var b=d3.pie().sort(e.sort).value(function(t){return t.disabled?0:t.value})(t),x=d3.arc().innerRadius(y).outerRadius(g).context(n);if("svg"===a){var v=d3.select(r).append("svg").attr("width",i).attr("height",o),k=e.position||d3.translate(i/2,o/2),w=v.append("g").attr("class","pie").attr("transform",k).attr("stroke",d).attr("stroke-width",c),S=d3.scaleOrdinal(p),O=function(t){return S(t.data.label)},C=(w.selectAll(".arc").data(b).enter().append("g").attr("class","arc").append("path").attr("d",x).attr("fill",O),e.labels);C.show&&w.selectAll(".arc").append("text").attr("class","label").attr("x",function(t){return x.centroid(t)[0]}).attr("y",function(t){return x.centroid(t)[1]}).attr("text-anchor","middle").attr("fill",C.fill).text(C.text).attr("opacity",function(t){var e=t.endAngle-t.startAngle;return e>=C.minAngle?1:0});var z=e.legend;if(z.show){var A=z.position,j=z.symbol,P=Math.round(j.width),M=Math.round(j.height),I=e.textColor,R=e.disabledTextColor,D=v.append("g").attr("class","legend").attr("transform",A).attr("cursor","pointer").selectAll(".legend-item").data(b).enter().append("g").attr("class",function(t){return"legend-item"+(t.data.disabled?" disabled":"")});D.append("rect").attr("width",P).attr("height",M).attr("x",0).attr("y",function(t,e){return u*(e+1)-M}).attr("fill",function(t){return t.data.disabled?R:S(t.data.label)}),D.append("text").text(z.text).attr("x",P+h/4).attr("y",function(t,e){return u*(e+1)}).attr("fill",function(t){return t.data.disabled?R:I}),D.on("click",function(r){var a=r.data.label,n=r.data.disabled;t.some(function(t){return t.label===a&&(t.disabled=!n,!0)}),v.remove(),d3.pieChart(t,e)})}var H=e.tooltip;if(H.show){var W=d3.select("#"+H.id);w.selectAll(".arc").on("mouseover",function(t){var e=d3.mouse(r);d3.select(this).select("path").attr("fill",d3.color(S(t.data.label)).darker()),W.attr("class","tooltip").style("display","block"),W.html(H.html(t)).style("left",e[0]+"px").style("top",e[1]+"px")}).on("mousemove",function(t){var e=d3.mouse(r),a=parseInt(W.style("width"))/2,n=parseInt(W.style("height"))+u/6;W.style("left",e[0]-a+"px").style("top",e[1]-n+"px")}).on("mouseout",function(){d3.select(this).select("path").attr("fill",O),W.style("display","none")})}}else"canvas"===a&&(n.translate(i/2,o/2),b.forEach(function(t,e){n.beginPath(),x(t),n.fillStyle=p[e],n.fill(),n.closePath()}),"none"!==d&&(n.beginPath(),b.forEach(x),n.strokeStyle=d,n.lineWidth=c,n.stroke(),n.closePath()))},d3.components.lineChart={type:"line chart",schema:{type:"object",entries:[{key:"label",type:"string",mappings:["category","name"]},{key:"value",type:"number",mappings:["count","percentage"]}]},sort:null,labels:{show:!1},tooltip:{show:!0,html:function(t,e){return"Datum "+e}}},d3.lineChart=function(t,e){t=d3.parseData("lineChart",t),e=d3.parseOptions("lineChart",e);var r=e.chart,a=e.renderer,n=(e.context,e.width),i=e.height,o=(e.innerWidth,e.innerHeight,e.stroke),s=e.strokeWidth,l=e.colorScheme;e.fontSize,e.lineHeight;if("svg"===a){var d=d3.select(r).append("svg").attr("width",n).attr("height",i),c=e.position||d3.translate(n/2,i/2);d.append("g").attr("class","line").attr("transform",c).attr("stroke",o).attr("stroke-width",s),d3.scaleOrdinal(l)}},d3.components.bubbleChart={type:"bubble chart",schema:{type:"object",entries:[{key:"x",type:"number",mappings:["category","name","year"]},{key:"y",type:"number",mappings:["count"]},{key:"z",type:"number",mappings:[]}]},offsetX:[.5,.5],offsetY:[0,0],framed:!1,axisX:{orient:"bottom",ticks:8,tickSizeInner:6,tickSizeOuter:0,tickPadding:4,tickFormat:"d"},axisY:{orient:"left",ticks:6,tickSizeInner:6,tickSizeOuter:0,tickPadding:4,tickFormat:"d"},gridX:{show:!0,stroke:"#999",strokeDash:[6,4]},gridY:{show:!1,stroke:"#999",strokeDash:[6,4]},labelX:{show:!1,text:"X"},labelY:{show:!1,text:"Y"},dots:{scale:"2%",minRadius:4,stroke:"#fff",opacity:.8,gradient:!1,hue:160,saturation:.8,lightness:.6},tooltip:{show:!0,html:function(t){return"x = "+t.x+"<br/>y = "+t.y+"<br/>z = "+t.z}}},d3.bubbleChart=function(t,e){t=d3.parseData("bubbleChart",t),e=d3.parseOptions("bubbleChart",e);var r=e.chart,a=e.renderer,n=(e.context,e.width),i=e.height,o=e.innerWidth,s=e.innerHeight,l=e.margin,d=e.stroke,c=e.strokeWidth,p=e.colorScheme,h=e.fontSize,u=e.lineHeight,f=e.offsetX,m=e.offsetY,g=t.map(function(t){return t.x}),y=t.map(function(t){return t.y}),b=t.map(function(t){return t.z}),x=d3.min(g),v=d3.max(g),k=d3.min(y),w=d3.max(y),S=(d3.min(b),d3.max(b)),O=d3.scaleLinear().domain(e.domainX||[x-f[0],v+f[1]]).range(e.rangeX||[0,o]),C=d3.scaleLinear().domain(e.domainY||[k-m[0],w+m[1]]).range(e.rangeY||[s,0]);if("svg"===a){var z=d3.select(r).append("svg").attr("width",n).attr("height",i),A=z.append("g").attr("class","bubble").attr("transform",d3.translate(l.left,l.top)).attr("stroke",d).attr("stroke-width",c),j=e.axisX,P=e.axisY,M=j.orient,I=P.orient,R=d3.setAxis(O,j),D=d3.setAxis(C,P);if(e.framed)A.append("g").attr("class","axis axis-x").attr("transform",d3.translate(0,s)).call(R),A.append("g").attr("class","axis axis-y").call(D),A.append("g").attr("class","axis axis-x").call(R.tickFormat("")),A.append("g").attr("class","axis axis-y").attr("transform",d3.translate(o,0)).call(D.tickFormat(""));else{var H=A.append("g").attr("class","axis axis-x").call(R),W=A.append("g").attr("class","axis axis-y").call(D);"bottom"===M&&H.attr("transform",d3.translate(0,s)),"right"===I&&W.attr("transform",d3.translate(o,0))}A.selectAll(".axis").attr("font-size",h);var N=e.gridX,X=e.gridY;N.show&&(A.append("g").attr("class","grid grid-x").attr("stroke-dasharray",N.strokeDash.join()).call(D.tickSize(-o,0).tickFormat("")),A.select(".grid-x").select(".domain").attr("stroke-width",0),A.select(".grid-x").selectAll(".tick").attr("stroke-width",function(){var t=d3.select(this).attr("transform"),e=+t.split(/[\,\(\)]/)[2];return 0===e||e===s?0:null}).select("line").attr("stroke",N.stroke)),X.show&&(A.append("g").attr("class","grid grid-y").attr("stroke-dasharray",X.strokeDash.join()).attr("transform",d3.translate(0,s)).call(R.tickSize(-s,0).tickFormat("")),A.select(".grid-y").select(".domain").attr("stroke-width",0),A.select(".grid-y").selectAll(".tick").attr("stroke-width",function(){var t=d3.select(this).attr("transform"),e=+t.split(/[\,\(\)]/)[1];return 0===e||e===o?0:null}).select("line").attr("stroke",X.stroke));var Y=e.labelX,F=e.labelY;Y.show&&A.append("text").attr("class","label label-x").attr("text-anchor","end").attr("x",o).attr("y",s).attr("dy","3em").text(Y.text),F.show&&A.append("text").attr("class","label label-y").attr("text-anchor","end").attr("y",0).attr("dy","-3em").attr("transform","rotate(-90)").text(F.text);var E=d3.scaleOrdinal(p),V=e.dots,L=V.scale,$=V.minRadius,T=V.opacity,q=V.hue,B=V.saturation,G=V.lightness,J=A.selectAll(".dot").data(t).enter().append("circle").attr("class","dot").attr("cx",function(t){return O(t.x)}).attr("cy",function(t){return C(t.y)}).attr("r",function(t){return Math.sqrt(t.z/S)*L+$}).attr("opacity",T).attr("stroke",V.stroke).attr("fill",function(t){if("function"==typeof V.color)return V.color(t);if(V.gradient){var e=q*(1-t.y/w)+(180-q),r=B*(t.y-k)/(w-k||1)+(1-B),a=G-(1-G)*(t.x-x)/(v-x||1);return d3.hsl(e,r,a)}return E(t.x)}).sort(function(t,e){return e.z-t.z});V.onclick&&J.attr("cursor","pointer").on("click",function(t){"function"==typeof V.onclick&&V.onclick(t)});var K=e.tooltip;if(K.show){var Q=d3.select("#"+K.id);J.on("mouseover",function(t){var e=d3.mouse(r);Q.attr("class","tooltip").style("display","block"),Q.html(K.html(t)).style("left",e[0]+"px").style("top",e[1]+"px")}).on("mousemove",function(t){var e=d3.mouse(r),a=parseInt(Q.style("width"))/2,n=parseInt(Q.style("height"))+u/6;Q.style("left",e[0]-a+"px").style("top",e[1]-n+"px")}).on("mouseout",function(){Q.style("display","none")})}}},d3.components.sunburstChart={type:"sunburst chart",schema:{type:"object",hierarchy:"children",entries:[{key:"label",type:"string",mappings:["category","name"]},{key:"value",type:"number",mappings:["count"]},{key:"children",type:"array"}]},sort:null,donut:{show:!1,ratio:.2,radius:20},zoomable:!0,labels:{show:!1},tooltip:{show:!0,html:function(t){return t.data.label+": "+t.data.value}},stroke:"#fff",colorScheme:d3.schemeCategory20c},d3.sunburstChart=function(t,e){t=d3.parseData("sunburstChart",t),e=d3.parseOptions("sunburstChart",e);var r=e.chart,a=e.renderer,n=e.context,i=e.width,o=e.height,s=(e.innerWidth,e.innerHeight,e.stroke),l=e.strokeWidth,d=e.colorScheme,c=(e.fontSize,e.lineHeight),p=Math.min(i,o)/2,h=d3.scaleLinear().range([0,2*Math.PI]),u=d3.scaleSqrt().range([0,p]),f=d3.hierarchy(t,function(t){return t.children}).sum(function(t){return t.children?0:t.value});"function"==typeof e.sort&&f.sort(e.sort),d3.partition()(f);var m=d3.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,h(t.x0)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,h(t.x1)))}).innerRadius(function(t){return Math.max(0,u(t.y0))}).outerRadius(function(t){return Math.max(0,u(t.y1))}).context(n);if("svg"===a){var g=d3.select(r).append("svg").attr("width",i).attr("height",o),y=e.position||d3.translate(i/2,o/2),b=g.append("g").attr("class","sunburst").attr("transform",y).attr("stroke",s).attr("stroke-width",l),x=d3.scaleOrdinal(d),v=e.donut,k=b.selectAll(".arc").data(f.descendants()).enter().append("g").attr("class","arc").append("path").attr("d",m).attr("opacity",function(t){return v.show&&null===t.parent?0:null}).attr("fill",function(t){return x((t.children?t:t.parent).data.label)});e.zoomable&&k.attr("cursor","pointer").on("click",function(t){var e=p*v.ratio||v.radius;b.transition().tween("scale",function(){var r=d3.interpolate(h.domain(),[t.x0,t.x1]),a=d3.interpolate(u.domain(),[t.y0,1]),n=d3.interpolate(u.range(),[t.y0?e:0,p]);return function(t){h.domain(r(t)),u.domain(a(t)).range(n(t))}}).selectAll("path").attrTween("d",function(t){return function(){return m(t)}})});var w=e.tooltip;if(w.show){var S=d3.select("#"+w.id);k.on("mouseover",function(t){var e=d3.mouse(r);S.attr("class","tooltip").style("display","block"),S.html(w.html(t)).style("left",e[0]+"px").style("top",e[1]+"px")}).on("mousemove",function(t){var e=d3.mouse(r),a=parseInt(S.style("width"))/2,n=parseInt(S.style("height"))+c/6;S.style("left",e[0]-a+"px").style("top",e[1]-n+"px")}).on("mouseout",function(){S.style("display","none")})}}},d3.components.choroplethMap={type:"choropleth map",schema:{type:"object",entries:[{key:"id",type:"string",mappings:["adcode","code","name"]},{key:"value",type:"number",mappings:["count"]}]},projection:"geoMercator",coloring:"ordinal",graticules:{show:!1,step:[10,10],stroke:"#ccc"},stroke:"#666",fill:"#ccc",colorScheme:d3.schemeCategory20c},d3.choroplethMap=function(t,e){t=d3.parseData("choroplethMap",t),e=d3.parseOptions("choroplethMap",e);var r=e.chart,a=e.id,n=e.renderer,i=(e.context,e.width),o=e.height,s=(e.innerWidth,e.innerHeight,e.stroke),l=e.fill,d=e.strokeWidth,c=e.colorScheme,p=(e.fontSize,e.lineHeight,e.map),h=d3[e.projection]().translate([i/2,o/2]).center(p.center).scale(o*p.scale),u=d3.geoPath().projection(h);if("svg"===n){var f=d3.select(r).append("svg").attr("width",i).attr("height",o),m=e.position||d3.translate(0,0),g=f.append("g").attr("class","map").attr("transform",m).attr("stroke",s).attr("stroke-width",d).attr("fill",l),y=d3.scaleOrdinal(c),b=e.coloring;d3.getMap(p,function(t){var e=t.features,r=t.neighbors;g.selectAll(".region").data(e).enter().append("path").attr("class","region").attr("d",u).attr("id",function(t){return a+"-"+t.id}).attr("fill",function(t,a){return"topological"===b&&r.length?(t.color=(0|d3.max(r[a],function(t){return e[t].color}))+1,y(t.color)):y(t.id)})});var x=e.graticules,v=d3.geoGraticule().step(x.step);x.show&&g.append("path").datum(v).attr("class","graticule").attr("d",u).attr("stroke",x.stroke)}};